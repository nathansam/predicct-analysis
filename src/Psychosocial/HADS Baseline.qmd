---
title: "HADS Baseline - Interim Report"
author:
  - name: "Chiara Cotronei"
    url: https://www.research.ed.ac.uk/en/persons/chiara-cotronei
    affiliations:
      - ref: Lothian
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE, error = FALSE, warning = TRUE)
```

```{r load libraries, warn.conflicts = FALSE}
library(plyr) # Used for mapping values
suppressPackageStartupMessages(library(tidyverse)) # ggplot2, dplyr, and magrittr
library(readxl) # Read in Excel files
library(datefixR) # Standardise dates  
library(openxlsx)
library(tidyr)
library(ggdist)
library(rstatix)

suppressPackageStartupMessages(library(table1))
library(knitr)
library(pander)
library(kableExtra)

# Generate flowchart of cohort derivation
library(DiagrammeR)
library(DiagrammeRsvg)

#cox-regression
library(survival)
library(survminer)
library(finalfit)

```

```{r access to data}
# paths to PREdiCCt data
if (file.exists("/.dockerenv")) {
  # If running in docker
  data.path <- "data/final/20221004/"
  redcap.path <- "data/final/20231030/"
  prefix <- "data/end-of-follow-up/"
  outdir <- "data/processed"
} else {
  # Run on OS directly
  data.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20221004/"
  redcap.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20231030/"
  prefix <- "/Volumes/igmm/cvallejo-predicct/predicct/end-of-follow-up/"
  outdir <- "/Volumes/igmm/cvallejo-predicct/predicct/processed/"
}
```

```{r load data}
#read-in data
#hads is question 42 of the baseline questionnaire
hads <- read.xlsx(paste0(data.path, "Baseline2022/hads.xlsx"))
health <- read.xlsx(paste0(data.path, "Baseline2022/health.xlsx"))
demographics <- read.xlsx(paste0(data.path, "Baseline2022/demographics2022.xlsx"))
lifeevents <- read.xlsx(paste0(data.path, "Baseline2022/lifeevents.xlsx"))
IBD <- read.xlsx(paste0(data.path, "Baseline2022/IBD.xlsx"))
ffq <- read.xlsx(paste0(prefix, "predicct ffq_nutrientfood groupDQI all foods_data (n1092)Nov2022.xlsx"))
demo <- readRDS("/Volumes/igmm/cvallejo-predicct/predicct/processed/demo.RDS")
flares <- readRDS("/Volumes/igmm/cvallejo-predicct/predicct/processed/flares/cutoff-flares.RDS")
IBD_C <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/IBD_C.RDS")
IBD_FC <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/IBD_FC.RDS")
```

```{r, tidy data}
#Exclude blank rows (where ParticipantId is missing, all data sets)
hads <- hads %>%
  filter(!is.na(ParticipantId))

health <- health %>%
  filter(!is.na(ParticipantId))

demographics <- demographics %>% 
  filter(!is.na(ParticipantId))

IBD <- IBD %>% 
  filter(!is.na(ParticipantId))
```





### The Hospital Anxiety and Depression Scale

Participants filled out the HADS questionnaire (presented below) at baseline. This questionnaire allows for calculation of depression and anxiety scores separately.
 
![image](/Users/chiaracotronei/documents/Baseline/HADSquestionnaire.png)


## Analysis of baseline HADS


### Methods

Participants <18 years old (n=53) and participants missing baseline faecal calprotectin (n = 209) were excluded.
Participants missing HADS data (n=9) were excluded.
Scores were re-coded to reflect HADS scoring: HADS questions are scored 0-3 or 3-0 (as visible in image above), questionnaire responses were scored 1-4 (where 1 = 1st choice option, 2 = 2nd etc). 
Scores were grouped separately for anxiety and depression, as per HADS-questionnaire, into 'normal' (0-7), 'borderline abnormal' (8-10) and 'abnormal' (11-21). In this report we will refer to "borderline abnormal" as "moderate", and "abnormal" as "high".
This data is saved as "hads_with_demographics" (separate columns for anxiety and depression scores) and "hads_for_analysis" with variable hads_type (duplicate rows of participants).


We tested for associations of diagnosis type (CD vs UC/IBDU), sex, age group, flares reported in the previous year (flare vs no flares) and faecal calprotectin (by categories: <50, 50-250, >250) with score groups for anxiety and depression separately. This was done for the PREdiCCt IBD cohort as a whole, and for CD and UC/IBDU groups separately.
Testing for associations was done by chi-square test or Fisher's exact test. 

```{r, join demographics, delete missing data, tidy HADS}
#join demographics
hads_with_demographics <- hads %>% 
  left_join(demographics %>% select(ParticipantNo, Sex, age, diagnosis), by = "ParticipantNo")

hads_with_demographics$diagnosis2 <- plyr::mapvalues(hads_with_demographics$diagnosis,
  from = seq(1, 4),
  to = c(1, 2, 2, 2)
) %>%
  factor(levels = c("1", "2"), labels = c("CD", "UC/IBDU"))

#exclude participants <17, 53 participants excluded, tot 1847
hads_with_demographics <- hads_with_demographics[hads_with_demographics$age > 17,]

#make sex into factor
hads_with_demographics$Sex <- factor(hads_with_demographics$Sex, levels = c(1, 2), labels = c("Male", "Female"))

#delete missing data, 9 participants, total 1838
hads_with_demographics <- hads_with_demographics %>%
  filter(rowSums(!is.na(select(., 7:20))) == length(7:20))

#correcting all HADS scores
if (any(hads_with_demographics$FeelTense == 4) || any(hads_with_demographics$CanEnjoyBookTV == 4))
  hads_with_demographics <- hads_with_demographics %>% 
    mutate_at(vars("FeelTense" : "CanEnjoyBookTV"), list( ~ . - 1))

#correcting inversely coded HADS
hads_with_demographics <- hads_with_demographics %>%
  mutate_at(vars("FeelTense", 
                 "FrightenedFeelingSomethingAwful", 
                 "WorryingThoughts", 
                 "FeelCheerful", 
                 "FeelSlowedDown",
                 "LostInterestAppearance",
                 "FeelRestless",
                 "SuddenFeelingsPanic"), 
            ~recode(., `3` = 0, `2` = 1, `1` = 2, `0` = 3))

#anxiety HADS
hads_with_demographics <- hads_with_demographics %>% 
  mutate(anxiety_hads = FeelTense + 
           FrightenedFeelingSomethingAwful + 
           WorryingThoughts +
           SitAtEase +
           FrightenedFeelingButterflies +
           FeelRestless +
           SuddenFeelingsPanic)

#depression HADS
hads_with_demographics <- hads_with_demographics %>% 
  mutate(depression_hads = EnjoyThings +
           CanLaugh +
           FeelCheerful +
           FeelSlowedDown +
           LostInterestAppearance +
           LookForward +
           CanEnjoyBookTV)

#remove breakdown hads columns
hads_with_demographics <- hads_with_demographics[, -(7:20)]

#create age groups
hads_with_demographics$AgeGroup <- cut(hads_with_demographics$age, 
                         breaks = c(18, 24, 34, 44, 54, 65, Inf), 
                         labels = c("18-24", "25-34", "35-44", "45-54", "55-64", "65+"),
                         include.lowest = TRUE)

#add FC data and exclude missing FC
hads_with_demographics <- hads_with_demographics %>% 
  left_join(demo %>% select(ParticipantNo, FC, cat, IMD, Smoke))
hads_with_demographics <- hads_with_demographics %>% 
  filter(!is.na(cat))

#Join flare data
hads_with_demographics <- hads_with_demographics %>% 
  left_join(IBD %>% select(ParticipantNo, FlaresInPastYear))
#create flare groups
hads_with_demographics <- hads_with_demographics %>%
  mutate(flare_group = ifelse(FlaresInPastYear == 0, "No Flares", "1 or More Flares"))
#make flares into levels
hads_with_demographics$flare_group <- factor(hads_with_demographics$flare_group, levels = c( "No Flares","1 or More Flares"))
hads_with_demographics <- hads_with_demographics %>% 
  filter(!is.na(flare_group))

#create hads_for_analysis which has new variable 'hads_type'
hads_for_analysis <- hads_with_demographics %>%
  gather(key = "hads_type", value = "hads_score", anxiety_hads, depression_hads)

#score groups
hads_for_analysis <- hads_for_analysis %>% 
  mutate(
    score_group = cut(hads_score, breaks = c(0, 7, 10, 21), labels = c("0-7", "8-10", "11-21"), include.lowest = TRUE)
  )

save_path <- "/Volumes/igmm/cvallejo-predicct/people/chiara/"
saveRDS(hads_with_demographics, paste0(save_path, "hads_with_demographics.RDS"))
saveRDS(hads_for_analysis, paste0(save_path, "hads_for_analysis.RDS"))
```


### Baseline scores

At baseline, anxiety scores tended to be higher for anxiety compared than for depression. 

Reference to baseline population. 
[Could be interesting to reflect on this - does HADS tend to create lower scores in general for depression? Is this due to anxiety often preceding the development of depression? Is this a true reflection of mental disease burden in IBD population? Is anxiety higher prevalence than depression in whole population? Are people with depression less likely to carry out questionnaires than people with anxiety?]



```{r, baseline distribution of anxiety and depression scores}
ggplot(hads_for_analysis, aes(x = hads_score, colour = hads_type)) +
  geom_line(stat = "count", aes(y = stat(count))) +
  labs(title = "Distribution of baseline HADS Scores",
       x = "HADS score",
       y = "Number of Participants") +
  theme_classic()

filtered_data_anxiety <- hads_for_analysis[hads_for_analysis$hads_type == "anxiety_hads", ]

my.render.cont <- function(x) {
  with(
    stats.apply.rounding(stats.default(x),
      digits = 3,
      round.integers = FALSE
    ),
    c("", "Median (IQR)" = sprintf("%s (%s - %s)", MEDIAN, Q1, Q3))
  )
}

table1::table1(~ score_group | hads_type,
  data = hads_for_analysis,
  render.continuous = my.render.cont,
  caption = "Distribution across score groups, Anxiety and Depression"
)

table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = filtered_data_anxiety,
  render.continuous = my.render.cont,
  caption = "Distribution of Baseline Anxiety Scores across Key Variables"
)

#depression_hads
filtered_data_depression <- hads_for_analysis[hads_for_analysis$hads_type == "depression_hads", ]

table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = filtered_data_depression,
  render.continuous = my.render.cont,
  caption = "Distribution of Baseline Depression Scores across Key Variables"
)

#create subgroups for analysis

#UC anxiety
anxiety_uc <- filtered_data_anxiety[filtered_data_anxiety$diagnosis2 == "UC/IBDU",]
#UC depression
depression_uc <- filtered_data_depression[filtered_data_depression$diagnosis2 == "UC/IBDU",]
#CD anxiety
anxiety_cd <- filtered_data_anxiety[filtered_data_anxiety$diagnosis2 == "CD",]
#CD depression
depression_cd <- filtered_data_depression[filtered_data_depression$diagnosis2 == "CD",]


```

#### Association of baseline HADS with key variables

Associations with anxiety scores:

* no association between diagnosis groups
* significant association with sex
* significant association with age group
* significant association with flares in previous year
* no association with FC

Associations with depression scores:

* no association between diagnosis groups
* no association with sex
* association with age group whole cohort and UC/IBDU, not in CD separately 
* significant association with flares in previous year whole coort and CD, but not true for UC/IBDU group
* no association with FC


#### Diagnosis type

There are no significant differences in HADS-Anxiety or HADS-Depression score groups between CD and UC/IBDU cohorts.


```{r, hads ad diagnosis tyoe}
# Create the contingency table
contingency_table_anxiety <- table(filtered_data_anxiety$diagnosis2, filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_anxiety$p.value < alpha) {
  message("There is a significant association between diagnosis type and anxiety score groups")
} else {
  message("There is no significant association between diagnosis type and anxiety score groups")
}


# Create the contingency table
contingency_table_depression <- table(filtered_data_depression$diagnosis2, filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
print(chi_squared_result_depression)
#check for significance
alpha <- 0.05
if (chi_squared_result_depression$p.value < alpha) {
  message("There is a significant association between diagnosis type and score group in depression HADS.")
} else {
  message("There is no significant association between diagnosis type and depression score groups.")
}


```



#### Sex

Anxiety scores and sex:

* significant association in whole cohort (p-value = 3.448e-10)
* significant in CD cohort (p-value = 3.196e-05)
* significant in UC/IBDU cohort (p-value = 1.866e-05)

Depression scores and sex:

* no significant association in whole cohort, CD or UC/IBDU groups



```{r, table for data ad chi sq}

# Create the contingency table
contingency_table_anxiety <- table(filtered_data_anxiety$Sex, filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_anxiety$p.value < alpha) {
  message("There is a significant association between sex and anxiety score groups")
} else {
  message("There is no significant association between sex and anxiety score groups")
}

#anxiety cd
contingency_table_anxiety <- table(anxiety_uc$Sex, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)

#anxiety UC
contingency_table_anxiety <- table(anxiety_cd$Sex, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)

# Create the contingency table
contingency_table_depression <- table(filtered_data_depression$Sex, filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
print(chi_squared_result_depression)
#check for significance
alpha <- 0.05
if (chi_squared_result_depression$p.value < alpha) {
  message("There is a significant association between sex and score group in depression HADS.")
} else {
  message("There is no significant association between sex and depression score groups.")
}

contingency_table_depression <- table(depression_cd$Sex, depression_cd$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
print(chi_squared_result_depression)

contingency_table_depression <- table(depression_uc$Sex, depression_uc$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
print(chi_squared_result_depression)
```



#### Age group


We compared score groups for HADS-Anxiety and HADS-Depression scores across age groups using chi squared and found: 

Age groups and anxiety scores

* significant associations in whole cohort (p-value = 5.289e-08)
* significant in CD cohort (p-value = p-value = 0.006)
* significant in UC/IBDU cohort (p-value = 0.001)

Age groups and depression scores

* significant associations in whole cohort (p-value = 0.031)
* no significant in CD cohort (p-value = 0.078)
* significant in UC/IBDU cohort (p-value = 0.036)

As seen from the graphs below, a higher proportion of young people have moderate and high risk for anxiety. Interpretation of associations with age and depression scores is more challenging and the association is weaker. 



```{r, correlation with age, HADS, chi-sq}

percentages <- filtered_data_anxiety %>%
  group_by(AgeGroup, score_group) %>%
  summarise(count = n()) %>%
  group_by(AgeGroup) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = AgeGroup, group = AgeGroup)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Anxiety Scores per age group",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()

contingency_table_anxiety <- table(filtered_data_anxiety$AgeGroup, filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_anxiety$p.value < alpha) {
  message("There is a significant association between age groups and anxiety score groups")
} else {
  message("There is no significant association between age groups and anxiety score groups")
}

contingency_table_anxiety <- table(anxiety_cd$AgeGroup, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)

contingency_table_anxiety <- table(anxiety_uc$AgeGroup, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)


#derpression and age group
percentages <- filtered_data_depression %>%
  group_by(AgeGroup, score_group) %>%
  summarise(count = n()) %>%
  group_by(AgeGroup) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = AgeGroup, group = AgeGroup)) +
  geom_line() +
  labs(title = "Distribution of baseline depression HADS Scores per age group",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme_classic()


contingency_table_depression <- table(filtered_data_depression$AgeGroup, filtered_data_depression$score_group)
#chi.sq
chi_squared_result_dep <- chisq.test(contingency_table_depression)
print(chi_squared_result_dep)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_dep$p.value < alpha) {
  message("There is a significant association between age groups and depression score groups")
} else {
  message("There is no significant association between age groups and depression score groups")
}

contingency_table_depression <- table(depression_cd$AgeGroup, depression_cd$score_group)
chi_squared_result_dep <- chisq.test(contingency_table_depression)
print(chi_squared_result_dep)

contingency_table_depression <- table(depression_uc$AgeGroup, depression_uc$score_group)
chi_squared_result_dep <- chisq.test(contingency_table_depression)
print(chi_squared_result_dep)
```

We additionally used linear modelling to investigate for association between HADS scores and age. 
This showed there is a significant correlation between age and anxiety scores (Multiple R-squared:  0.03132,	Adjusted R-squared:  0.03079 , p-value: 2.14e-14), but not between age and depression scores (Multiple R-squared:  1.505e-06,	Adjusted R-squared:  -0.0005432,  p-value = 0.9581)

```{r, lm anxiety and depression and age}
correlation_result_age_anxiety <- lm(age ~ hads_score, data = filtered_data_anxiety)
summary(correlation_result_age_anxiety)

correlation_result_age_depression <- lm(age ~ hads_score, data = filtered_data_depression)
summary(correlation_result_age_depression)

ggplot(filtered_data_anxiety, aes(x = age, y = hads_score)) +
  geom_point() +  # Scatter plot
  geom_smooth(method = "lm", se = FALSE, color = "blue") +  # Regression line
  labs(title = "Relationship between Age and Anxiety Score",
       subtitle = "Younger age is associated with higher anxiety scores.",
       x = "Age",
       y = "Anxiety Score") +
  theme_minimal()
```


#### Flare groups (flare vs no flare in last year)

We used chi-square to test for differences in HADS across flare groups. When looking at all patients, HADS scores (anxiety and depression) were higher in those who had experienced a flare in the last year.

Reporting flares in previous year and anxiety scores

* associated in whole cohort (p-value = 0.00027)
* associated in CD (p-value = 0.007)
* associated in UC (p-value = 0.009)


Reporting flares in previous year and depression scores

* associated in whole cohort (p-value = = 0.001)
* associated in CD (p-value = 0.007)
* not associated in UC (p-value = 0.062)



Note will need to do plots to prove directionality of this relationship (done for whole cohort, not for UC/IBDU and CD individually)
```{r, chi-sq for association between HADS ands flare group}

#anxiety
contingency_table_anxiety <- table(filtered_data_anxiety$flare_group, filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
print(chi_squared_result_anxiety)

contingency_cd_anx <- table(anxiety_cd$flare_group, anxiety_cd$score_group)
chi_squared <- chisq.test(contingency_cd_anx)
print(chi_squared)

contingency_uc_anx <- table(anxiety_uc$flare_group, anxiety_uc$score_group)
chi_squared <- chisq.test(contingency_uc_anx)
print(chi_squared)

#depression
contingency_table_depression <- table(filtered_data_depression$flare_group, filtered_data_depression$score_group)
contingency_table_depression
chi_squared_result_depression <- chisq.test(contingency_table_depression)
print(chi_squared_result_depression)

contingency_cd_dep <- table(depression_cd$flare_group, depression_cd$score_group)
chi_squared <- chisq.test(contingency_cd_dep)
print(chi_squared)

contingency_uc_dep <- table(depression_uc$flare_group, depression_uc$score_group)
chi_squared <- chisq.test(contingency_uc_dep)
print(chi_squared)


#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(flare_group, score_group) %>%
  summarise(count = n()) %>%
  group_by(flare_group) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = flare_group, group = flare_group)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Anxiety scores per age group",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()


# plots to illustrate the above - depression whole
percentages <- filtered_data_depression %>%
  group_by(flare_group, score_group) %>%
  summarise(count = n()) %>%
  group_by(flare_group) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = flare_group, group = flare_group)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Depression scores if flare reported last year",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()


```



#### Faecal calprotectin


There was no significant association between faecal calprotectin at baseline (grouped) and anxiety HADS scores or depression HADS scores. 
This was true for when looking at UC/IBDU and CD together or separately.


```{r, difference in FC across anxiety groups}
#anxiety
contingency_table <- table(filtered_data_anxiety$cat, filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
print(chi_squared_result_anxiety)

contingency_table <- table(anxiety_cd$cat, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
print(chi_squared_result_anxiety)

contingency_table <- table(anxiety_uc$cat, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
print(chi_squared_result_anxiety)

#depression
contingency_table <- table(filtered_data_depression$cat, filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
print(chi_squared_result_depression)

contingency_table <- table(depression_cd$cat, depression_cd$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
print(chi_squared_result_depression)

contingency_table <- table(depression_uc$cat, depression_uc$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
print(chi_squared_result_depression)
```





### IBD-control scores and HADS

We investigate for associations with HADS scores and IBD-control scores. IBD control scores are strongly correlated with HADS Anxiety and Depression scores.

IBD control-8 and anxiety scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value < 2.2e-16)
* significant association UC/IBDU cohort (p-value < 2.2e-16)

IBD control-8 and depression scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value < 2.2e-16)
* significant association UC/IBDU cohort (p-value < 2.2e-16)

```{r, merge flare data with hads demo data, then re-code intogroups as for hads_for_analysis}
hads_control <- hads_for_analysis %>% 
  left_join(IBD_C %>% select(ParticipantNo, control_score, OverallControl, control_8, control_grouped, vas_control), by = "ParticipantNo")

#36 missing values from control8/controlVAS scores (18 participants)
missing_C8 <- hads_control %>% 
  filter(is.na(control_grouped))

#exclude missing control scores
hads_control <- hads_control %>% 
  filter(!is.na(control_grouped))

```

```{r, HADS and control - 8}

#change control_grouped and vas_control from character into factors
hads_control$control_grouped <- factor(hads_control$control_grouped)
hads_control$vas_control <- factor(hads_control$vas_control)

filtered_data_anxiety <- hads_control[hads_control$hads_type == "anxiety_hads", ]
filtered_data_depression <- hads_control[hads_control$hads_type == "depression_hads", ]

#all participants
data_flare_a <- hads_control[hads_control$hads_type == "anxiety_hads",]
contingency_table_flare <- table(data_flare_a$score_group, data_flare_a$control_grouped)
chi_squared_result <- chisq.test(contingency_table_flare)
print(chi_squared_result)

#anxiety, cd only
data_flare_c <- data_flare_a[data_flare_a$diagnosis2 == "CD",]
contingency_table_c <- table(data_flare_c$score_group, data_flare_c$control_grouped)
chi_squared_result <- chisq.test(contingency_table_c)
print(chi_squared_result)

#anxiety, uc/ibdu only
data_flare_b <- data_flare_a[data_flare_a$diagnosis2 == "UC/IBDU",]
contingency_table_b <- table(data_flare_b$score_group, data_flare_b$control_grouped)
chi_squared_result <- chisq.test(contingency_table_b)
print(chi_squared_result)


#depression, all
data_flare_d <- hads_control[hads_control$hads_type == "depression_hads",]
contingency_table_flare <- table(data_flare_d$score_group, data_flare_d$control_grouped)
chi_squared_result <- chisq.test(contingency_table_flare)
print(chi_squared_result)

#depression, uc/ibdu
data_flare_e <- data_flare_d[data_flare_d$diagnosis2 == "UC/IBDU",]
contingency_table_e <- table(data_flare_e$score_group, data_flare_e$control_grouped)
chi_squared_result <- chisq.test(contingency_table_e)
print(chi_squared_result)

#depression, CD only
data_flare_f <- data_flare_d[data_flare_d$diagnosis2 == "CD",]
contingency_table_f <- table(data_flare_f$score_group, data_flare_f$control_grouped)
chi_squared_result <- chisq.test(contingency_table_f)
print(chi_squared_result)

#siginificant association across all

#table for anxiety
table1::table1(~ control_grouped | diagnosis2 + score_group,
  data = data_flare_a,
  render.continuous = my.render.cont,
  title = "Distribution of IBD-Control 8 scores and anxiety HADS"
)

table1::table1(~ control_grouped | diagnosis2 + score_group,
  data = data_flare_d,
  render.continuous = my.render.cont,
  title = "Distribution of IBD-Control 8 scores and depression HADS"
)

#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(control_grouped, score_group) %>%
  summarise(count = n()) %>%
  group_by(control_grouped) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = control_grouped, group = control_grouped)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Anxiety scores per IBD control-8 scores",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()

percentages <- filtered_data_depression %>%
  group_by(control_grouped, score_group) %>%
  summarise(count = n()) %>%
  group_by(control_grouped) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = control_grouped, group = control_grouped)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Depression scores per IBD control-8 scores",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()
```

We investigate for associations with HADS scores and IBD-control scores. 

IBD control-vas and anxiety scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value = 4.543e-14)
* significant association UC/IBDU cohort (p-value = 3.175e-10)

IBD control-8 and depression scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value = 1.594e-14
* significant association UC/IBDU cohort (p-value = 3.745e-08)



```{r, HADS and control - vas}

#all partipants
data_flare_a <- hads_control[hads_control$hads_type == "anxiety_hads",]
contingency_table_flare <- table(data_flare_a$score_group, data_flare_a$vas_control)
chi_squared_result <- chisq.test(contingency_table_flare)
print(chi_squared_result)

#anxiety, uc/ibdu only
data_flare_b <- data_flare_a[data_flare_a$diagnosis2 == "UC/IBDU",]
contingency_table_b <- table(data_flare_b$score_group, data_flare_b$vas_control)
chi_squared_result <- chisq.test(contingency_table_b)
print(chi_squared_result)

#anxiety, cd only
data_flare_c <- data_flare_a[data_flare_a$diagnosis2 == "CD",]
contingency_table_c <- table(data_flare_c$score_group, data_flare_c$vas_control)
chi_squared_result <- chisq.test(contingency_table_c)
print(chi_squared_result)

#depression, all
data_flare_d <- hads_control[hads_control$hads_type == "depression_hads",]
contingency_table_flare <- table(data_flare_d$score_group, data_flare_d$vas_control)
chi_squared_result <- chisq.test(contingency_table_flare)
print(chi_squared_result)

#depression, uc/ibdu
data_flare_e <- data_flare_d[data_flare_d$diagnosis2 == "UC/IBDU",]
contingency_table_e <- table(data_flare_e$score_group, data_flare_e$vas_control)
chi_squared_result <- chisq.test(contingency_table_e)
print(chi_squared_result)

#depression, CD only
data_flare_f <- data_flare_d[data_flare_d$diagnosis2 == "CD",]
contingency_table_f <- table(data_flare_f$score_group, data_flare_f$vas_control)
chi_squared_result <- chisq.test(contingency_table_f)
print(chi_squared_result)

#siginificant association across all
table1::table1(~ vas_control | diagnosis2 + score_group,
  data = data_flare_a,
  render.continuous = my.render.cont,
  title = "Distribution of IBD-vas scores and anxiety HADS"
)

table1::table1(~ vas_control | diagnosis2 + score_group,
  data = data_flare_d,
  render.continuous = my.render.cont,
  title = "Distribution of IBD-vas scores and depression HADS"
)

#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(vas_control, score_group) %>%
  summarise(count = n()) %>%
  group_by(vas_control) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = vas_control, group = vas_control)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Anxiety scores per IBD control-vas ",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()

percentages <- filtered_data_depression %>%
  group_by(vas_control, score_group) %>%
  summarise(count = n()) %>%
  group_by(vas_control) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = vas_control, group = vas_control)) +
  geom_line() +
  labs(title = "Distribution of baseline HADS-Depression scores per IBD control-vas",
       x = "HADS score group",
       y = "Number of Participants") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_classic()
```



## Reproduction and reproducibility {.appendix}

<details class = "appendix">
  <summary> Session info </summary>

```{R Session info}
#| echo: false
pander::pander(sessionInfo())
```

</details>

Licensed by 
<a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a>
 unless otherwise stated.
 
 
