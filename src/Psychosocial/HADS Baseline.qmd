---
title: "HADS Baseline - Interim Report"
author:
  - name: "Chiara Cotronei"
    url: https://www.research.ed.ac.uk/en/persons/chiara-cotronei
    
    affiliations:
      - ref: Lothian
bibliography: Psychosocial.bib   
---

```{r setup, warn.conflicts = FALSE}
knitr::opts_chunk$set(echo = TRUE, error = FALSE, warning = TRUE)
options(dplyr.summarise.inform = FALSE)

library(plyr) # Used for mapping values
suppressPackageStartupMessages(library(tidyverse)) # ggplot2, dplyr, and magrittr
library(readxl) # Read in Excel files
library(datefixR) # Standardise dates  
library(openxlsx)
library(tidyr)
library(ggdist)
suppressPackageStartupMessages(library(rstatix))
suppressPackageStartupMessages(library(table1))
library(knitr)
library(pander)
suppressPackageStartupMessages(library(kableExtra))
# Generate flowchart of cohort derivation
library(DiagrammeR)
library(DiagrammeRsvg)

#cox-regression
library(survival)
suppressPackageStartupMessages(library(survminer))
library(finalfit)

# paths to PREdiCCt data
if (file.exists("/.dockerenv")) {
  # If running in docker
  data.path <- "data/final/20221004/"
  redcap.path <- "data/final/20231030/"
  prefix <- "data/end-of-follow-up/"
  outdir <- "data/processed"
} else {
  # Run on OS directly
  data.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20221004/"
  redcap.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20231030/"
  prefix <- "/Volumes/igmm/cvallejo-predicct/predicct/end-of-follow-up/"
  outdir <- "/Volumes/igmm/cvallejo-predicct/predicct/processed/"
}

#read-in data
#hads is question 42 of the baseline questionnaire
hads <- read.xlsx(paste0(data.path, "Baseline2022/hads.xlsx"))
health <- read.xlsx(paste0(data.path, "Baseline2022/health.xlsx"))
demographics <- read.xlsx(paste0(data.path, "Baseline2022/demographics2022.xlsx"))
lifeevents <- read.xlsx(paste0(data.path, "Baseline2022/lifeevents.xlsx"))
IBD <- read.xlsx(paste0(data.path, "Baseline2022/IBD.xlsx"))
ffq <- read.xlsx(paste0(prefix, "predicct ffq_nutrientfood groupDQI all foods_data (n1092)Nov2022.xlsx"))
demo <- readRDS(paste0(outdir, "demo.RDS"))
flares <- readRDS(paste0(outdir, "flares/cutoff-flares.RDS"))
IBD_C <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/IBD_C.RDS")
IBD_FC <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/IBD_FC.RDS")

#Exclude blank rows (where ParticipantId is missing, all data sets)
hads <- hads %>%
  filter(!is.na(ParticipantId))

health <- health %>%
  filter(!is.na(ParticipantId))

demographics <- demographics %>% 
  filter(!is.na(ParticipantId))

IBD <- IBD %>% 
  filter(!is.na(ParticipantId))
```

### The Hospital Anxiety and Depression Scale

Participants filled out the HADS questionnaire (presented below) at baseline.
This questionnaire allows for calculation of depression and anxiety scores
separately.
 
## Analysis of baseline HADS

### Methods

```{r, join demographics, delete missing data, tidy HADS}
#join demographics
hads_with_demographics <- hads %>%
  dplyr::left_join(demographics %>%
                     dplyr::select(ParticipantNo, Sex, age, diagnosis),
                   by = "ParticipantNo")

# Convert column to factor with labels
hads_with_demographics %<>%
  dplyr::mutate(
    diagnosis2 = dplyr::case_when(
      diagnosis == 1 ~ 1,
      diagnosis == 2 ~ 2,
      diagnosis == 3 ~ 2,
      diagnosis == 4 ~ 2
    )
  ) %>%
  dplyr::mutate(
    diagnosis2 = factor(
      diagnosis2,
      levels = c("1", "2"), 
      labels = c("CD", "UC/IBDU")
    )
  )

hads_with_demographics %<>%
  dplyr::mutate(Sex = factor(
    Sex,
    levels = c(1, 2),
    labels = c("Male", "Female")
  )
)

#exclude participants <17, 53 participants excluded, tot 1847

n_underage <- hads_with_demographics %>%
  dplyr::filter(age <= 17) %>%
  nrow()

hads_with_demographics %<>%
  dplyr::filter(age > 17)


#delete missing data, 9 participants, total 1838

n_missing_hads <- hads_with_demographics %>%
  dplyr::filter(
    dplyr::if_any(.cols = 7:20, .fns = is.na)
  ) %>%
  nrow()

hads_with_demographics %<>%
  dplyr::filter(
    !dplyr::if_any(.cols = 7:20, .fns = is.na)
  )


#correcting all HADS scores
# Original data is on a 1 to 4 scale, rescale to between 0 and 3.
# HADS scores with a max of 4
# hads_scores_4 <- hads_with_demographics %>%
#   dplyr::select(FeelTense:CanEnjoyBookTV) %>%
#   dplyr::summarise(
#     dplyr::across(.cols = everything(), .fns = max)
#   ) %>% 
#   tidyr::pivot_longer(
#     cols = everything(),
#     names_to = "Score",
#     values_to = "max"
#   )

hads_with_demographics %<>%
  dplyr::mutate(
    dplyr::across(
      .cols = FeelTense:CanEnjoyBookTV,
      .fns = ~. - 1)
  )

  
#correcting inversely coded HADS
hads_with_demographics %<>%
  dplyr::mutate(
    dplyr::across(
      .cols = c("FeelTense", 
                 "FrightenedFeelingSomethingAwful", 
                 "WorryingThoughts", 
                 "FeelCheerful", 
                 "FeelSlowedDown",
                 "LostInterestAppearance",
                 "FeelRestless",
                 "SuddenFeelingsPanic"),
      .fns = ~ 3 - .
    )
  )

#anxiety HADS composite score
hads_with_demographics %<>% 
  dplyr::mutate(anxiety_hads = FeelTense + 
           FrightenedFeelingSomethingAwful + 
           WorryingThoughts +
           SitAtEase +
           FrightenedFeelingButterflies +
           FeelRestless +
           SuddenFeelingsPanic)

#depression HADS composite score
hads_with_demographics %<>% 
  dplyr::mutate(depression_hads = EnjoyThings +
           CanLaugh +
           FeelCheerful +
           FeelSlowedDown +
           LostInterestAppearance +
           LookForward +
           CanEnjoyBookTV)

#remove breakdown hads columns
hads_with_demographics %<>%
  dplyr::select(-c(FeelTense:CanEnjoyBookTV))


#create age groups
hads_with_demographics %<>%
  dplyr::mutate(AgeGroup = cut(
    age,
    breaks = c(18, 24, 34, 44, 54, 65, Inf),
    labels = c("18-24", "25-34", "35-44", "45-54", "55-64", "65+"),
    include.lowest = TRUE
  ))


#add FC data and exclude missing FC
hads_with_demographics <- hads_with_demographics %>% 
  dplyr::left_join(
    demo %>% dplyr::select(ParticipantNo, FC, cat, IMD, Smoke), 
    by = "ParticipantNo")

n_missing_fc <- hads_with_demographics %>% 
  filter(is.na(cat)) %>%
  nrow()
# 209 removed with no ibd category

hads_with_demographics <- hads_with_demographics %>% 
  filter(!is.na(cat))

#Join flare data
hads_with_demographics <- hads_with_demographics %>% 
  dplyr::left_join(
    IBD %>% select(ParticipantNo, FlaresInPastYear), 
    by = "ParticipantNo"
    )

#create flare groups
hads_with_demographics <- hads_with_demographics %>%
  dplyr::mutate(
    flare_group = ifelse(FlaresInPastYear == 0, "No flares", "One or more flares")
    )

#make flares into levels
hads_with_demographics %<>%
  dplyr::mutate(flare_group = factor(flare_group, levels = c("No flares","One or more flares")))

# Remove subjects with missing flare group data - 3 subjects
hads_with_demographics <- hads_with_demographics %>% 
  filter(!is.na(flare_group))

#create hads_for_analysis which has new variable 'hads_type' for anxiety and depression hads
hads_for_analysis <- hads_with_demographics %>%
  tidyr::pivot_longer(
    cols = c(anxiety_hads, depression_hads),
    names_to = "hads_type", values_to = "hads_score"
  ) 

#score groups
hads_for_analysis <- hads_for_analysis %>% 
  mutate(
    score_group = cut(
      hads_score, 
      breaks = c(0, 7, 10, 21), 
      labels = c("0-7", "8-10", "11-21"), 
      include.lowest = TRUE)
  )

# save_path <- "/Volumes/igmm/cvallejo-predicct/people/chiara/"
# saveRDS(hads_with_demographics, paste0(save_path, "hads_with_demographics.RDS"))
# saveRDS(hads_for_analysis, paste0(save_path, "hads_for_analysis.RDS"))
```

Participants <18 years old (n = `r n_underage`) and participants missing
baseline faecal calprotectin (FC; n = `r n_missing_fc`) were excluded.
Participants missing HADS data (n = `r n_missing_hads`) were also excluded.

Scores were re-coded to reflect HADS scoring: HADS questions are scored 0-3 or
3-0 (as visible in image above), questionnaire responses were scored 1-4 (where
1 = 1st choice option, 2 = 2nd etc). 

Scores were grouped separately for anxiety and depression, as per
HADS-questionnaire, into 'normal' (0-7), 'borderline abnormal' (8-10) and
'abnormal' (11-21). In this report we will refer to "borderline abnormal" as
"moderate", and "abnormal" as "high".

This data is saved as "hads_with_demographics" (separate columns for anxiety and
depression scores) and "hads_for_analysis" with variable `hads_type` used to
identify whether the score is for depression or anxiety (multiple rows per
participant).

We tested for associations of diagnosis type (CD vs UC/IBDU), sex, age group,
flares reported in the previous year (flare vs no flares) and faecal
calprotectin (by categories: <50, 50-250, >250) with score groups for anxiety
and depression separately. This was done for the PREdiCCt IBD cohort as a whole,
and for CD and UC/IBDU groups separately. Testing for associations was done by
chi-square test or Fisher's exact test. 


### Baseline scores

At baseline, anxiety scores tended to be higher for anxiety compared than for
depression. 

A recent meta-analysis by @Barberio2021 looking at the prevalence of anxiety and
depression in people with IBD found that 

* Overall, pooled prevalence of anxiety symptoms was 32·1% (95% CI 28·3-36·0) in
  58 studies ($I^2$=96·9%) and pooled prevalence of depression symptoms was
  25·2% (22·0-28·5) in 75 studies ($I^2$=97·6%). 
* In studies that reported prevalence of anxiety or depression in patients with
  Crohn's disease and ulcerative colitis within the same study population,
  patients with Crohn's disease had higher odds of anxiety symptoms (OR 1·2,
  95% CI 1·1-1·4) and depression symptoms (1·2, 1·1-1·4) than patients with
  ulcerative colitis. 
* Overall, women with IBD were more likely to have symptoms of anxiety than were
  men with IBD (pooled prevalence 33·8% [95% CI 26·5-41·5] for women vs 22·8%
  [18·7-27·2] for men; OR 1·7 [95% CI 1·2-2·3]). They were also more likely to
  have symptoms of depression than men were (pooled prevalence 21·2% [95% CI
  15·4-27·6] for women vs 16·2% [12·6-20·3] for men; OR 1·3 [95% CI 1·0-1·8]).

Our findings also show higher rates of anxiety compare to depression, and higher
rates of anxiety in women compared to men. However we did not find any
difference between sexes in rates of depression. We also did not find any
difference across diagnosis (Crohn's vs UC/IBDU).

```{r, baseline distribution of anxiety and depression scores}
#| label: fig-HADS-dist
#| fig-cap: "Distribution of baseline HADS Scores"
ggplot(hads_for_analysis, aes(x = hads_score, colour = hads_type)) +
  geom_line(stat = "count", aes(y = after_stat(count))) +
  labs(x = "HADS score",
       y = "Number of Participants") +
  scale_color_discrete(name = "HADS type",
                       labels = c("Anxiety", "Depression")) +
  theme_minimal()
```


```{R}
#| label: tbl-hads-dist
#| tbl-cap: "Distribution across score types (anxiety and depression)"
filtered_data_anxiety <-
  hads_for_analysis[hads_for_analysis$hads_type == "anxiety_hads", ]

my.render.cont <- function(x) {
  with(
    stats.apply.rounding(stats.default(x),
      digits = 3,
      round.integers = FALSE
    ),
    c("", "Median (IQR)" = sprintf("%s (%s - %s)", MEDIAN, Q1, Q3))
  )
}

table1::table1(~ score_group | hads_type,
  data = hads_for_analysis,
  render.continuous = my.render.cont
)
```

```{R}
#| label: tbl-vars-by-anxiety
#| tbl-cap: Distribution of baseline anxiety scores across key variables
table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = filtered_data_anxiety,
  render.continuous = my.render.cont
)
```


#### Association of baseline HADS with key variables


```{R}
#| label: tbl-vars-by-depression
#| tbl-cap: "Distribution of Baseline Depression Scores across Key Variables"
#depression_hads
filtered_data_depression <-
  hads_for_analysis[hads_for_analysis$hads_type == "depression_hads", ]

table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = filtered_data_depression,
  render.continuous = my.render.cont
)
```

```{R}
#create subgroups for analysis

#UC anxiety
anxiety_uc <- filtered_data_anxiety[filtered_data_anxiety$diagnosis2 == "UC/IBDU",]
#UC depression
depression_uc <- filtered_data_depression[filtered_data_depression$diagnosis2 == "UC/IBDU",]
#CD anxiety
anxiety_cd <- filtered_data_anxiety[filtered_data_anxiety$diagnosis2 == "CD",]
#CD depression
depression_cd <- filtered_data_depression[filtered_data_depression$diagnosis2 == "CD",]
```

Associations with anxiety scores:

* no association between diagnosis groups
* significant association with sex
* significant association with age group
* significant association with flares in previous year
* no association with FC

Associations with depression scores:

* no association between diagnosis groups
* no association with sex
* association with age group whole cohort and UC/IBDU, not in CD separately 
* significant association with flares in previous year whole cohort and CD, but
  not true for UC/IBDU group
* no association with FC


#### Diagnosis type

There are no significant differences in HADS-Anxiety or HADS-Depression score
groups between CD and UC/IBDU cohorts.

```{r, hads and diagnosis type}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption

# Create the contingency table
contingency_table_anxiety <- table(filtered_data_anxiety$diagnosis2,
                                   filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_anxiety$p.value < alpha) {
  cat("There is a significant association between diagnosis type and anxiety score groups.\n")
} else {
  cat("There is no significant association between diagnosis type and anxiety score groups.\n")
}

chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption

# Create the contingency table
contingency_table_depression <- table(filtered_data_depression$diagnosis2,
                                      filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)

#check for significance
if (chi_squared_result_depression$p.value < alpha) {
  cat("There is a significant association between diagnosis type and score group in depression HADS.\n")
} else {
  cat("There is no significant association between diagnosis type and depression score groups.\n")
}

chi_squared_result_depression %>%
  pander()
```

#### Sex

Anxiety scores and sex:

* significant association in whole cohort (p-value = 3.448e-10)
* significant in CD cohort (p-value = 3.196e-05)
* significant in UC/IBDU cohort (p-value = 1.866e-05)

Depression scores and sex:

* no significant association in whole cohort, CD or UC/IBDU groups



```{r, table for data and chi sq}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption

# Create the contingency table
contingency_table_anxiety <- table(filtered_data_anxiety$Sex,
                                   filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_anxiety$p.value < alpha) {
  cat("There is a significant association between sex and anxiety score groups.\n")
} else {
  cat("There is no significant association between sex and anxiety score groups.\n")
}
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption

#anxiety cd
contingency_table_anxiety <- table(anxiety_uc$Sex, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
#anxiety UC
contingency_table_anxiety <- table(anxiety_cd$Sex, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption

# Create the contingency table

contingency_table_depression <- table(filtered_data_depression$Sex,
                                      filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
#check for significance

if (chi_squared_result_depression$p.value < alpha) {
  cat("There is a significant association between sex and score group in depression HADS.\n")
} else {
  cat("There is no significant association between sex and depression score groups.\n ")
}
chi_squared_result_depression %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_depression <- table(depression_cd$Sex,
                                      depression_cd$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
chi_squared_result_depression %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_depression <- table(depression_uc$Sex,
                                      depression_uc$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
chi_squared_result_depression %>% pander()
```

#### Age group

We compared score groups for HADS-Anxiety and HADS-Depression scores across age
groups using chi squared and found: 

Age groups and anxiety scores

* Significant associations in whole cohort (p-value = 5.289e-08)
* Significant in CD cohort (p-value = p-value = 0.006)
* Significant in UC/IBDU cohort (p-value = 0.001)

Age groups and depression scores

* Significant associations in whole cohort (p-value = 0.031)
* Not significant in CD or UC/IBDU

As seen from the graphs below, a higher proportion of young people have moderate
and high risk for anxiety. Interpretation of associations with age and
depression scores is more challenging and the association is weaker. 

```{r, correlation with age and HADS via chi-sq}
#| label: fig-anxiety-age
#| fig-cap: "Distribution of baseline HADS anxiety scores by age group."

percentages <- filtered_data_anxiety %>%
  group_by(AgeGroup, score_group) %>%
  summarise(count = n()) %>%
  group_by(AgeGroup) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group,
                        y = percentage,
                        colour = AgeGroup,
                        group = AgeGroup)) +
  geom_line() +
  labs(color = "Age",
       group = "Age",
       x = "HADS anxiety score group",
       y = "Number of Participants") +
  # Format y-axis as percentage
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  
  theme_minimal()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_anxiety <- table(filtered_data_anxiety$AgeGroup,
                                   filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)

if (chi_squared_result_anxiety$p.value < alpha) {
  cat("There is a significant association between age groups and anxiety score groups.\n")
} else {
  cat("There is no significant association between age groups and anxiety score groups.\n")
}

chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_anxiety <- table(anxiety_cd$AgeGroup, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_anxiety <- table(anxiety_uc$AgeGroup, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| label: fig-depression-age
#| fig-cap: "Distribution of baseline depression HADS Scores per age group."
# depression and age group
percentages <- filtered_data_depression %>%
  group_by(AgeGroup, score_group) %>%
  summarise(count = n()) %>%
  group_by(AgeGroup) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages,
       aes(x = score_group,
           y = percentage,
           colour = AgeGroup,
           group = AgeGroup)) +
  geom_line() +
  labs(x = "HADS depression score",
       y = "Number of Participants",
       color = "Age",
       group = "Age") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  theme_minimal()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_table_depression <- table(filtered_data_depression$AgeGroup,
                                      filtered_data_depression$score_group)
chi_squared_result_dep <- chisq.test(contingency_table_depression)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result_dep$p.value < alpha) {
  cat("There is a significant association between age groups and depression score groups.\n")
} else {
  cat("There is no significant association between age groups and depression score groups.\n")
}
chi_squared_result_dep %>%
  pander()
```

```{R}
contingency_table_depression <- table(depression_cd$AgeGroup,
                                      depression_cd$score_group)
cat(sum(table(depression_cd$AgeGroup, depression_cd$score_group) < 5),
    " cells have fewer than 5 observations. Using Fisher's exact test.\n")
chi_squared_result_dep <- fisher.test(contingency_table_depression,
                                      simulate.p.value = TRUE,
                                      B = 100000)

chi_squared_result_dep %>%
  pander()
```

```{R}
contingency_table_depression <- table(depression_uc$AgeGroup,
                                      depression_uc$score_group)
cat(sum(table(depression_cd$AgeGroup, depression_cd$score_group) < 5),
    " cells have fewer than 5 observations. Using Fisher's exact test.\n")
chi_squared_result_dep <- fisher.test(contingency_table_depression,
                                      simulate.p.value = TRUE,
                                      B = 100000)
chi_squared_result_dep %>%
  pander()
```

We additionally used linear modelling to investigate for association between
HADS scores and age. 

This showed there is a significant correlation between age and anxiety scores
(Multiple R-squared:  0.03132,	Adjusted R-squared:  0.03079 , p-value:
2.14e-14), but not between age and depression scores (Multiple R-squared:
1.505e-06,	Adjusted R-squared:  -0.0005432,  p-value = 0.9581)

```{R, lm anxiety and depression and age}
correlation_result_age_anxiety <- lm(age ~ hads_score,
                                     data = filtered_data_anxiety)
correlation_result_age_anxiety %>%
  summary() %>%
  pander()
```

```{R}
correlation_result_age_depression <- lm(age ~ hads_score,
                                        data = filtered_data_depression)
correlation_result_age_depression %>%
  summary() %>%
  pander()
```

```{R}
#| label: fig-age-anxiety-lm
#| fig-cap: "Relationship between age and anxiety scores"
#| fig-subcap: "Younger age is associated with higher anxiety scores."
ggplot(filtered_data_anxiety, aes(x = age, y = hads_score)) +
  geom_point(alpha = 0.2) +  # Scatter plot, add alpha (transparency)
  geom_smooth(method = "lm", se = FALSE, color = "#5BC0EB") +  # Regression line
  labs(x = "Age",
       y = "HADS anxiety score") +
  theme_minimal()
```


#### Flare groups (flare vs no flare in last year)

We used chi-square to test for differences in HADS across flare groups. When
looking at all patients, HADS scores (anxiety and depression) were higher in
those who had experienced a flare in the last year.

Reported flares in previous year and anxiety scores:

* Associated in whole cohort (p-value = 0.00027)
* Associated in CD (p-value = 0.007)
* Associated in UC (p-value = 0.009)


Reported flares in previous year and depression scores:

* Associated in whole cohort (p-value = = 0.001)
* Associated in CD (p-value = 0.007)
* Not associated in UC (p-value = 0.062)

::: {.callout-note}
We need to do plots to prove directionality of this relationship (done for whole
cohort, not for UC/IBDU and CD individually)
:::

```{r, chi-sq for association between HADS ands flare group}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
#anxiety
contingency_table_anxiety <- table(filtered_data_anxiety$flare_group,
                                   filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table_anxiety)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_cd_anx <- table(anxiety_cd$flare_group, anxiety_cd$score_group)
chi_squared <- chisq.test(contingency_cd_anx)
chi_squared %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_uc_anx <- table(anxiety_uc$flare_group, anxiety_uc$score_group)
chi_squared <- chisq.test(contingency_uc_anx)
chi_squared %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
#depression
contingency_table_depression <- table(filtered_data_depression$flare_group,
                                      filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table_depression)
chi_squared_result_depression %>%
  pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_cd_dep <- table(depression_cd$flare_group,
                            depression_cd$score_group)
chi_squared <- chisq.test(contingency_cd_dep)
chi_squared %>% pander()
```

```{R}
#| output: "asis"
#| results: "hold"
# TO-DO add table caption
contingency_uc_dep <- table(depression_uc$flare_group, depression_uc$score_group)
chi_squared <- chisq.test(contingency_uc_dep)
chi_squared %>%
  pander()
```

```{R}
#| label: fig-anxiety-prev-flare
#| fig-cap: "Distribution of baseline HADS-Anxiety scores per age group"

#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(flare_group, score_group) %>%
  summarise(count = n()) %>%
  group_by(flare_group) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages,
       aes(x = score_group,
           y = percentage,
           colour = flare_group,
           group = flare_group)) +
  geom_line() +
  labs(x = "HADS anxiety score",
       y = "Number of Participants",
       colour = "Flares in the last year",
       group = "Flares in the last year") +
  # Format y-axis as percentage
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  
  theme_minimal()
```

```{R}
#| label: fig-depression-prev-flare
#| fig-cap: "Distribution of baseline HADS-Depression scores if flare reported last year"
# plots to illustrate the above - depression whole
percentages <- filtered_data_depression %>%
  group_by(flare_group, score_group) %>%
  summarise(count = n()) %>%
  group_by(flare_group) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group,
                        y = percentage,
                        colour = flare_group,
                        group = flare_group)) +
  geom_line() +
  labs(x = "HADS Depression score",
       y = "Number of Participants",
       colour = "Flares in the last year",
       group = "Flares in the last year") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_minimal()
```

#### Faecal calprotectin

There was no significant association between faecal calprotectin at baseline (grouped) and anxiety HADS scores or depression HADS scores. 
This was true for when looking at UC/IBDU and CD together or separately.

```{r, difference in FC across anxiety groups}
# TO-DO add table caption
#anxiety
contingency_table <- table(filtered_data_anxiety$cat,
                           filtered_data_anxiety$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
# TO-DO add table caption
contingency_table <- table(anxiety_cd$cat, anxiety_cd$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
# TO-DO add table caption
contingency_table <- table(anxiety_uc$cat, anxiety_uc$score_group)
chi_squared_result_anxiety <- chisq.test(contingency_table)
chi_squared_result_anxiety %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression
contingency_table <- table(filtered_data_depression$cat,
                           filtered_data_depression$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
chi_squared_result_depression %>%
  pander()
```

```{R}
# TO-DO add table caption
contingency_table <- table(depression_cd$cat, depression_cd$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
chi_squared_result_depression %>%
  pander()
```

```{R}
# TO-DO add table caption
contingency_table <- table(depression_uc$cat, depression_uc$score_group)
chi_squared_result_depression <- chisq.test(contingency_table)
chi_squared_result_depression %>%
  pander()
```


```{R}
#| label: tbl-vars-by-anxiety_cd
#| tbl-cap: "Distribution of baseline anxiety scores across key variables - CD only"
table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = anxiety_cd,
  render.continuous = my.render.cont
)

#all tables for tables
#| tbl-cap: "Distribution of baseline anxiety scores by sex (CD only)"
table1::table1(~ score_group | Sex,
  data = anxiety_cd,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by age group (CD only)"
table1::table1(~ score_group | AgeGroup,
  data = anxiety_cd,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by previous flare (CD only)"
table1::table1(~ score_group | flare_group,
  data = anxiety_cd,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by faecal calprotectin (CD only)"
table1::table1(~ score_group | cat,
  data = anxiety_cd,
  render.continuous = my.render.cont
)

```

```{R}
#| label: tbl-vars-by-anxiety_uc
#| tbl-cap: "Distribution of baseline anxiety scores across key variables - UC/IBDU only"
table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat | score_group,
  data = anxiety_uc,
  render.continuous = my.render.cont
)

#all tables for tables
#| tbl-cap: "Distribution of baseline anxiety scores by sex (UC/IBDU only)"
table1::table1(~ score_group | Sex,
  data = anxiety_uc,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by age group (UC/IBDU only)"
table1::table1(~ score_group | AgeGroup,
  data = anxiety_uc,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by previous flare (UC/IBDU only)"
table1::table1(~ score_group | flare_group,
  data = anxiety_uc,
  render.continuous = my.render.cont
)

#| tbl-cap: "Distribution of baseline anxiety scores by faecal calprotectin (UC/IBDU only)"
table1::table1(~ score_group | cat,
  data = anxiety_uc,
  render.continuous = my.render.cont
)

```





### IBD-control scores and HADS

We investigate for associations with HADS scores and IBD-control scores. IBD
control scores are strongly correlated with HADS Anxiety and Depression scores.

IBD control-8 and anxiety scores

* Significant association whole cohort (p-value < 2.2e-16)
* Significant association CD cohort (p-value < 2.2e-16)
* Significant association UC/IBDU cohort (p-value < 2.2e-16)

IBD control-8 and depression scores

* Significant association whole cohort (p-value < 2.2e-16)
* Significant association CD cohort (p-value < 2.2e-16)
* Significant association UC/IBDU cohort (p-value < 2.2e-16)

```{R merge flare data with hads demo data then re-code into groups}
hads_control <- hads_for_analysis %>% 
  left_join(IBD_C %>% select(ParticipantNo,
                             control_score,
                             OverallControl,
                             control_8,
                             control_grouped,
                             vas_control),
            by = "ParticipantNo")

#36 missing values from control8/controlVAS scores (18 participants)
missing_C8 <- hads_control %>% 
  filter(is.na(control_grouped))

#exclude missing control scores
hads_control <- hads_control %>% 
  filter(!is.na(control_grouped))

#change control_grouped and vas_control from character into factors
hads_control$control_grouped <- factor(hads_control$control_grouped)
hads_control$vas_control <- factor(hads_control$vas_control)

filtered_data_anxiety <- hads_control[hads_control$hads_type == "anxiety_hads", ]
filtered_data_depression <- hads_control[hads_control$hads_type == "depression_hads", ]
```

```{R HADS and control - 8}
# TO-DO add table caption
#all participants
data_flare_a <- hads_control[hads_control$hads_type == "anxiety_hads",]
contingency_table_flare <- table(data_flare_a$score_group,
                                 data_flare_a$control_grouped)
chi_squared_result <- chisq.test(contingency_table_flare)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#anxiety, cd only
data_flare_c <- data_flare_a[data_flare_a$diagnosis2 == "CD",]
contingency_table_c <- table(data_flare_c$score_group,
                             data_flare_c$control_grouped)
chi_squared_result <- chisq.test(contingency_table_c)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#anxiety, uc/ibdu only
data_flare_b <- data_flare_a[data_flare_a$diagnosis2 == "UC/IBDU",]
contingency_table_b <- table(data_flare_b$score_group, data_flare_b$control_grouped)
chi_squared_result <- chisq.test(contingency_table_b)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, all
data_flare_d <- hads_control[hads_control$hads_type == "depression_hads",]
contingency_table_flare <- table(data_flare_d$score_group, data_flare_d$control_grouped)
chi_squared_result <- chisq.test(contingency_table_flare)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, uc/ibdu
data_flare_e <- data_flare_d[data_flare_d$diagnosis2 == "UC/IBDU",]
contingency_table_e <- table(data_flare_e$score_group, data_flare_e$control_grouped)
chi_squared_result <- chisq.test(contingency_table_e)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, CD only
data_flare_f <- data_flare_d[data_flare_d$diagnosis2 == "CD",]
contingency_table_f <- table(data_flare_f$score_group,
                             data_flare_f$control_grouped)
chi_squared_result <- chisq.test(contingency_table_f)
chi_squared_result %>%
  pander()
```

```{R}
#| label: tbl-control-8-anxiety
#| tbl-cap: "Distribution of IBD-Control 8 scores and anxiety HADS."
#| column: "page"

# Significant association across all

# Table for anxiety
table1::table1(~ control_grouped | diagnosis2 + score_group,
  data = data_flare_a,
  render.continuous = my.render.cont
)
```

```{R}
#| label: tbl-control-8-depression
#| tbl-cap: "Distribution of IBD-Control 8 scores and depression HADS."
#| column: "page"
table1::table1(~ control_grouped | diagnosis2 + score_group,
  data = data_flare_d,
  render.continuous = my.render.cont)
```

```{R}
#| label: fig-control8-anxiety
#| fig-cap: "Distribution of baseline HADS-Anxiety scores per IBD control-8 scores"
#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(control_grouped, score_group) %>%
  summarise(count = n()) %>%
  group_by(control_grouped) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group,
                        y = percentage,
                        colour = control_grouped,
                        group = control_grouped)) +
  geom_line() +
  labs(x = "HADS anxiety score",
       y = "Number of Participants",
       colour = "Control-8 score",
       group = "Control-8 score") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_minimal()
```

```{R}
#| label: fig-control-8-depression
#| fig-cap: "Distribution of baseline HADS-Depression scores per IBD control-8 scores"
percentages <- filtered_data_depression %>%
  group_by(control_grouped, score_group) %>%
  summarise(count = n()) %>%
  group_by(control_grouped) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group,
                        y = percentage,
                        colour = control_grouped,
                        group = control_grouped)) +
  geom_line() +
  labs(x = "HADS depression score",
       y = "Number of Participants",
       colour = "Control-8 score",
       group = "Control-8 score") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_minimal()
```

We investigate for associations with HADS scores and IBD-control scores. 

IBD control-vas and anxiety scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value = 4.543e-14)
* significant association UC/IBDU cohort (p-value = 3.175e-10)

IBD control-8 and depression scores

* significant association whole cohort (p-value < 2.2e-16)
* significant association CD cohort (p-value = 1.594e-14
* significant association UC/IBDU cohort (p-value = 3.745e-08)



```{r HADS and control - vas}
# TO-DO add table caption
#all participants
data_flare_a <- hads_control[hads_control$hads_type == "anxiety_hads",]
contingency_table_flare <- table(data_flare_a$score_group, data_flare_a$vas_control)
chi_squared_result <- chisq.test(contingency_table_flare)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#anxiety, uc/ibdu only
data_flare_b <- data_flare_a[data_flare_a$diagnosis2 == "UC/IBDU",]
contingency_table_b <- table(data_flare_b$score_group, data_flare_b$vas_control)
chi_squared_result <- chisq.test(contingency_table_b)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#anxiety, cd only
data_flare_c <- data_flare_a[data_flare_a$diagnosis2 == "CD",]
contingency_table_c <- table(data_flare_c$score_group, data_flare_c$vas_control)
chi_squared_result <- chisq.test(contingency_table_c)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, all
data_flare_d <- hads_control[hads_control$hads_type == "depression_hads",]
contingency_table_flare <- table(data_flare_d$score_group, data_flare_d$vas_control)
chi_squared_result <- chisq.test(contingency_table_flare)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, uc/ibdu
data_flare_e <- data_flare_d[data_flare_d$diagnosis2 == "UC/IBDU",]
contingency_table_e <- table(data_flare_e$score_group, data_flare_e$vas_control)
chi_squared_result <- chisq.test(contingency_table_e)
chi_squared_result %>%
  pander()
```

```{R}
# TO-DO add table caption
#depression, CD only
data_flare_f <- data_flare_d[data_flare_d$diagnosis2 == "CD",]
contingency_table_f <- table(data_flare_f$score_group, data_flare_f$vas_control)
chi_squared_result <- chisq.test(contingency_table_f)
chi_squared_result %>%
  pander()
```

```{R}
#| label: tbl-vas-anxiety
#| tbl-cap: "Distribution of IBD-vas scores and anxiety HADS"
#| column: "page"
# Significant association across all
table1::table1(~ vas_control | diagnosis2 + score_group,
  data = data_flare_a,
  render.continuous = my.render.cont
)
```

```{R}
#| label: tbl-vas-depression
#| tbl-cap:  "Distribution of IBD-vas scores and depression HADS"
#| column: "page"
table1::table1(~ vas_control | diagnosis2 + score_group,
  data = data_flare_d,
  render.continuous = my.render.cont
)
```

```{R}
#| label: fig-vas-anxiety
#| fig-cap: "Distribution of baseline HADS-Anxiety scores per IBD control-vas"

#plot- anxiety whole
percentages <- filtered_data_anxiety %>%
  group_by(vas_control, score_group) %>%
  summarise(count = n()) %>%
  group_by(vas_control) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group,
                        y = percentage,
                        colour = vas_control,
                        group = vas_control)) +
  geom_line() +
  labs(x = "HADS anxiety score",
       y = "Number of Participants",
       color = "VAS Control",
       group = "VAS Control") +
  # Format y-axis as percentage
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  
  theme_minimal()
```

```{R}
#| label: fig-vas-depression
#| fig-cap: "Distribution of baseline HADS-Depression scores per IBD control-vas"
percentages <- filtered_data_depression %>%
  group_by(vas_control, score_group) %>%
  summarise(count = n()) %>%
  group_by(vas_control) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(percentages, aes(x = score_group, y = percentage, colour = vas_control, group = vas_control)) +
  geom_line() +
  labs(x = "HADS depression score",
       y = "Number of Participants",
       color = "VAS Control",
       group = "VAS Control") +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +  # Format y-axis as percentage
  theme_minimal()
```

## Reproduction and reproducibility {.appendix}

<details class = "appendix">
  <summary> Session info </summary>

```{R Session info}
#| echo: false
pander::pander(sessionInfo())
```

</details>

Licensed by 
<a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a>
 unless otherwise stated.
 
