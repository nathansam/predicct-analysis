---
title: "Survival Analysis Psychosocial factors updated"
author:
  - name: "Chiara Cotronei"
    url: https://www.research.ed.ac.uk/en/persons/chiara-cotronei
    affiliations:
      - ref: Lothian
---

```{R setup}
knitr::opts_chunk$set(echo = TRUE, error = FALSE, warning = TRUE)

set.seed(123)
library(plyr) # Used for mapping values
suppressPackageStartupMessages(library(tidyverse)) # ggplot2, dplyr, and magrittr
library(readxl) # Read in Excel files
library(datefixR) # Standardise dates
library(openxlsx)
library(tidyr)
library(ggdist)
suppressPackageStartupMessages(library(rstatix))

suppressPackageStartupMessages(library(table1))
library(knitr)
library(pander)
suppressPackageStartupMessages(library(kableExtra))

# Generate flowchart of cohort derivation
library(DiagrammeR)
library(DiagrammeRsvg)

# cox-regression
library(survival)
suppressPackageStartupMessages(library(survminer))
library(finalfit)


panderOptions("digits", 5)


# paths to PREdiCCt data
if (file.exists("/.dockerenv")) {
  # If running in docker
  data.path <- "data/final/20221004/"
  redcap.path <- "data/final/20231030/"
  prefix <- "data/end-of-follow-up/"
  outdir <- "data/processed"
} else {
  # Run on OS directly
  data.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20221004/"
  redcap.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20231030/"
  prefix <- "/Volumes/igmm/cvallejo-predicct/predicct/end-of-follow-up/"
  outdir <- "/Volumes/igmm/cvallejo-predicct/predicct/processed/"
}

# read-in data
# hads is question 42 of the baseline questionnaire
hads <- read.xlsx(paste0(data.path, "Baseline2022/hads.xlsx"))
health <- read.xlsx(paste0(data.path, "Baseline2022/health.xlsx"))
flarecause <- read.xlsx(paste0(data.path, "Baseline2022/flarecause.xlsx"))
demographics <- read.xlsx(paste0(data.path, "Baseline2022/demographics2022.xlsx"))
lifeevents <- read.xlsx(paste0(data.path, "Baseline2022/lifeevents.xlsx"))
IBD <- read.xlsx(paste0(data.path, "Baseline2022/IBD.xlsx"))
ffq <- read.xlsx(paste0(prefix, "predicct ffq_nutrientfood groupDQI all foods_data (n1092)Nov2022.xlsx"))
demo <- readRDS(paste0(outdir, "demo.RDS"))
flares <- readRDS(paste0(outdir, "flares/cutoff-flares.RDS"))
hads_for_analysis <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/hads_for_analysis.rds")
demo_uc <- readRDS(paste0(outdir, "demo-uc.RDS"))
demo_cd <- readRDS(paste0(outdir, "demo-cd.RDS"))
flares_hard <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/flares_hard.RDS")
flares_soft <- readRDS("/Volumes/igmm/cvallejo-predicct/people/chiara/flares_soft.RDS")
```


## Introduction

```{r, dataset hads and hads flares}
hardflare_hads <- hads_for_analysis %>%
  inner_join(flares_hard %>% select(ParticipantNo, hardflare, hardflare_time),
    by = "ParticipantNo"
  ) %>%
  mutate(DiseaseFlareYN = hardflare, time = hardflare_time)
# 3508 here

softflare_hads <- hads_for_analysis %>%
  inner_join(
    flares_soft %>%
      select(ParticipantNo, softflare, softflare_time),
    by = join_by(ParticipantNo)
  ) %>%
  mutate(DiseaseFlareYN = softflare, time = softflare_time)
# 3620 here

# create hard flare data sets for both UC/IBDU and CD
flare_uc <- hardflare_hads %>%
  dplyr::filter(diagnosis2 == "UC/IBDU")

flare_uc_anx <- flare_uc %>%
  dplyr::filter(hads_type == "anxiety_hads")

flare_uc_dep <- flare_uc %>%
  dplyr::filter(hads_type == "depression_hads")


flare_cd <- hardflare_hads %>%
  dplyr::filter(diagnosis2 == "CD")

flare_cd_anx <- flare_cd %>%
  dplyr::filter(hads_type == "anxiety_hads")

flare_cd_dep <- flare_cd %>%
  dplyr::filter(hads_type == "depression_hads")

# hard flares, IBD whole cohort
hard_anxiety_IBD <- hardflare_hads%>%
  dplyr::filter(hads_type == "anxiety_hads")

hard_depression_IBD <- hardflare_hads%>%
  dplyr::filter(hads_type == "depression_hads")

# create soft flare data sets for both UC/IBDU and CD
soft_uc <- softflare_hads%>%
  dplyr::filter(diagnosis2 == "UC/IBDU")

soft_uc_anx <- soft_uc%>%
  dplyr::filter(hads_type == "anxiety_hads")

soft_uc_dep <- soft_uc%>%
  dplyr::filter(hads_type == "depression_hads")

soft_cd <- softflare_hads%>%
  dplyr::filter(diagnosis2 == "CD")

soft_cd_anx <- soft_cd%>%
  dplyr::filter(hads_type == "anxiety_hads")

soft_cd_dep <- soft_cd%>%
  dplyr::filter(hads_type == "depression_hads")

# soft flares, IBD whole cohort
soft_anxiety_IBD <- softflare_hads%>%
  dplyr::filter(hads_type == "anxiety_hads")

soft_depression_IBD <- softflare_hads%>%
  dplyr::filter(hads_type == "depression_hads")

#| output: "asis"
cox.summary <- function(fit) {
  cat("Cox model summary:")
  fit %>%
    finalfit::fit2df(condense = FALSE) %>%
    knitr::kable(
      col.names = c(
        "Variable",
        "HR",
        "Lower 95%",
        "Upper 95%",
        "P-value"
      ),
      digits = 4
    ) %>%
    print()

  cat("

Diagnostics: 

")

  cat("

::: {.panel-tabset}

      ")

  cat("

###### Proportional hazards assumption test 

  ")
  cox.zph(fit)$table %>%
    knitr::kable(
      col.names = c(
        "",
        "Chi-squared statistic",
        "DF",
        "P-value"
      ),
      digits = 4
    ) %>%
    print()

  cat("

###### DF betas 

  ")

  print(ggcoxdiagnostics(fit, type = "dfbeta"))

  cat("

###### Martingale residuals 

      ")

  print(ggcoxdiagnostics(fit, type = "martingale", linear.predictions = TRUE))

  cat("

:::

      ")
  return()
}
```

Here we present survival analysis (time to soft and hard flare) using
cox-regression models, stratifying by HADS anxiety/depression groups. 

We conducted three survival analyses:

1. Controlling for site only
2. Controlling for sex, IMD, site +/- age (if this was found to be
   significantly associated with scores at baseline). 
3. Controlling for factors above and faecal calprotectin additionally. 

Each analysis was conducted for the whole IBD cohort, and for UC/IBDU and CD
separately.

Full results of baseline analysis can be found in separate report (HADS Baseline).

## Analysis for whole cohort 

### Anxiety and patient-reported flare

* Controlling for site only, significant association both moderate (p=value =
  9.5e-05) and severe (p-value = 1.1e-07) anxiety
* Remains significant both groups when controlling for IMD, sex, age
  group, site - moderate (p-value = 0.0023, 95% CI 1.12-1.70) and severe
  (p-value = 0.00001, 95% CI 1.30-2.00)
* Remains significant when controlling for FC additionally for moderate
  (p-value = 0.001, 95% CI 1.14-1.73) and severe (p-value < 0.00001, 95% CI
  1.31-2.02)

```{r}
#| label: tbl-soft-flares-anxiety-whole
#| tbl-cap: "Log-rank test results for anxiety scores and patient-reported flares in whole IBD cohort"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_anxiety_IBD
)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_anxiety_IBD
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-anxiety-soft-whole
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by anxiety scores in whole IBD cohort"
p1 <- ggsurvplot(fit,
  data = soft_anxiety_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)
p1
```


```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_anxiety_IBD
)

invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    frailty(SiteNo),
  data = soft_anxiety_IBD
)


invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    cat +
    frailty(SiteNo),
  data = soft_anxiety_IBD
)
invisible(cox.summary(cox_model))
```

### Depression and patient-reported flares:


* Controlling for site only, significant for moderate (p-value = 0.0009, 95% CI
  1.18-1.95) and severe (p-value 0.014, 95% CI 1.08-2.07)
* Controlling for sex, IMD, age and site - significant for moderate
  (0.0019, 95% CI 1.15-1.92) and severe (p-value = 0.03, 95% CI 1.03-1.99)
  depression
* Controlling for FC additionally - significant for moderate (0.0008, 95% CI
  1.19-1.99) and severe (p-value = 0.043, 95% CI 1.01-1.95) depression

```{r}
#| label: tbl-soft-flares-depression-whole
#| tbl-cap: "Log-rank test results for depression scores and patient-reported flares in whole IBD cohort"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_depression_IBD)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_depression_IBD)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-soft-whole
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by depression scores in whole IBD cohort"
p1 <- ggsurvplot(fit,
  data = soft_depression_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p1
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_depression_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    frailty(SiteNo),
  data = soft_depression_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    cat +
    frailty(SiteNo),
  data = soft_depression_IBD
)

invisible(cox.summary(cox_model))
```

### Hard flare and anxiety (whole cohort)

Anxiety and hard flare
* no significant associations at any level

```{r}
#| label: tbl-hard-flares-anxiety-whole
#| tbl-cap: "Log-rank test results for anxiety scores and hard flares in whole IBD cohort"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = hard_anxiety_IBD)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_anxiety_IBD
)

test_result %>%
  pander()
```

```{R}
#| label: fig-km-anxiety-hard-whole
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by anxiety scores in whole IBD cohort"
p1 <- ggsurvplot(fit,
  data = hard_anxiety_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)
p1
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = hard_anxiety_IBD
)

invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    frailty(SiteNo),
  data = hard_anxiety_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    cat +
    frailty(SiteNo),
  data = hard_anxiety_IBD
)
invisible(cox.summary(cox_model))
```

### Depression and hard flare:


* Controlling for site only, significant association with moderate depression
  (p-value 0.005, 95% CI 1.18-2.60) but no significant association with severe
  depression
* Significant for moderate depression (p-value = 0.012, 95% CI 1.12-2.48) in
  analysis 2
* Controlling for FC additionally, significant for moderate depression
  (p-value = 0.009, 95% CI 1.14-2.54)

```{r}
#| label: tbl-hard-flares-depression-whole
#| tbl-cap: "Log-rank test results for depression scores and hard flares in whole IBD cohort"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_depression_IBD
)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_depression_IBD
)
test_result %>% pander()
```

```{R}
#| label: fig-km-depression-hard-whole
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by depression scores in whole IBD cohort"
p1 <- ggsurvplot(fit,
  data = hard_depression_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p1
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = hard_depression_IBD
)

invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    IMD +
    Sex +
    AgeGroup +
    frailty(SiteNo),
  data = hard_depression_IBD
)

invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~ score_group +
    IMD +
    Sex +
    AgeGroup +
    cat +
    frailty(SiteNo),
  data = hard_depression_IBD
)

invisible(cox.summary(cox_model))
```

## Analyses by subgroups (UC/IBDU vs CD)

### UC/IBDU and patient-reported flares

#### UC/IBDU anxiety scores and patient-reported flares

*	Controlling for site only, significant association with severe anxiety and
  risk of flare (p-value = 0.0024, 95% CI 1.17 - 2.14)
*	Controlling for site, sex, IMD and age group significant association
  with severe anxiety and risk of flare (p-value = 0.021, 95% CI 1.05 - 1.95)
*	Controlling for site, sex, IMD, age group and FC significant
  association with severe anxiety and risk of flare (p-value = 0.011, 95% CI
  1.09- 2.02)
  
  
```{r}
#| label: tbl-uc-anxiety-soft
#| tbl-cap: "Log-rank test results for anxiety scores and patient-reported flares in UC/IBDU patients"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_uc_anx)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_uc_anx
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-uc-anxiety-soft
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by anxiety scores in UC/IBDU patients"
p.uc.anx <- ggsurvplot(fit,
  data = soft_uc_anx,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)

p.uc.anx
```

```{R}
#| output: "asis"
# site only
# moderate p-value 0.09, severe p-value = 0.0004, 95% CI 1.24 - 2.18)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_uc_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex/IMD/age
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    frailty(SiteNo),
  data = soft_uc_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# 3 +FC
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    cat +
    frailty(SiteNo),
  data = soft_uc_anx
)
invisible(cox.summary(cox_model))
```

#### UC/IBDU depression scores and patient-reported flares

*	Controlling for site only, significant association with moderate depression
  and risk of flare (p-value = 0.008, 95% CI 1.12 - 2.25) and severe depression
  (p-value = 0.037, 95% CI 1.032-2.652)
*	Controlling for site, sex, IMD and age group, significant association
  with moderate (p-value = 0.009, 95% CI 1.13- 2.25) and severe (p-value =
  0.040, 95% CI 1.02 - 2.66) depression and risk of flare
*	Controlling for site, sex, and FC significant association with
  moderate (p-value = 0.004, 95% CI 1.27- 2.56) and severe (p-value = 0.048,
  95% CI 1.01 - 2.62) depression and risk of flare 


```{R}
#| label: tbl-uc-depression-soft
#| tbl-cap: "Log-rank test results for depression scores and patient-reported flares in UC/IBDU patients"
# depression
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_uc_dep)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_uc_dep
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-uc-depression-soft
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by depression scores in UC/IBDU patients"
p2 <- ggsurvplot(fit,
  data = soft_uc_dep,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p2
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_uc_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = soft_uc_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex/fc
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = soft_uc_dep
)
invisible(cox.summary(cox_model))
```

### UC/IBDU and Hard Flares

```{r}
#| label: tbl-uc-participants
#| tbl-cap: "UC/IBDU Participants within each score group"
# Nathan's code for tables function
my.render.cont <- function(x) {
  with(
    stats.apply.rounding(stats.default(x),
      digits = 3,
      round.integers = FALSE
    ),
    c("", "Median (IQR)" = sprintf("%s (%s - %s)", MEDIAN, Q1, Q3))
  )
}

# Make table showing how many in each group (anxiety/depression for UC)
#table1::table1(~ score_group | hads_type,
#  data = flare_uc,
#  render.continuous = my.render.cont,
#  caption = "UC/IBDU Participants within each score group"
#)
```

#### UC/IBDU Anxiety and time to hard flare

* Controlling for site only no significant association
* Controlling for site, sex, IMD and age, no significant association
* Controlling for site, sex, IMD, age and FC, no significant
  association
  
```{r}
#| label: tbl-uc-anxiety-hard
#| tbl-cap: "Log-rank test results for anxiety scores and hard flares in UC/IBDU patients"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = flare_uc_anx)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = flare_uc_anx
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-uc-anxiety-hard
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by anxiety scores in UC/IBDU patients"
p1 <- ggsurvplot(fit,
  data = flare_uc_anx,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)
p1
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group + frailty(SiteNo),
  data = flare_uc_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    frailty(SiteNo),
  data = flare_uc_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC cat)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    cat +
    frailty(SiteNo),
  data = flare_uc_anx
)
invisible(cox.summary(cox_model))
```


#### UC/IBDU Depression and time to hard flare

Note: violation of proportional hazards assumption

* Controlling for site only, significant association with moderate (8-10)
  depression and increased risk of hard flare (p-value 0.004, 95% CI 1.29-3.56)
* Controlling for site, sex, IMD and age, significant association with
  moderate (8-10) (p-value = 0.002, 95% CI 1.32-3.80) and severe (p-value =
  0.034, 95% CI 1.06-4.79) depression
* Controlling for confounders above and FC, significant association with
  moderate (8-10) (p-value = 0.0003, 95% CI 1.57-4.67) and severe
  (p-value = 0.041, 95% CI 1.03-4.69) depression

```{R}
#| label: tbl-uc-depression-hard
#| tbl-cap: "Log-rank test results for depression scores and hard flares in UC/IBDU patients"
# UC and depression hard flares
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = flare_uc_dep)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = flare_uc_dep
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-uc-depression-hard
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by depression scores in UC/IBDU patients"
p.uc.dep.hard <- ggsurvplot(fit,
  data = flare_uc_dep,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p.uc.dep.hard 
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = flare_uc_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = flare_uc_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC cat)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = flare_uc_dep
)
invisible(cox.summary(cox_model))
```

### CD and patient-reported flares 

n= 820, number of events= 279


#### CD anxiety scores

* Controlling for site only, significant associations with moderate (p-value =
  0.0013, 95% CI 1.32-2.36) and severe anxiety (p-value > 0.00001, 95% CI
  1.48-2.64) (remains strongly associate using FC dataset)
* Controlling for site, sex, IMD and age group, significant
  associations with moderate (p-value = 0.013, 95% CI 1.21-2.22) and severe
  anxiety (p-value > 0.0001, 95% CI 1.37-2.50)
*	Controlling for site, sex, IMD and age group, FC significant
  associations with moderate (p-value = 0.002, 95% CI 1.21-2.21) and severe
  anxiety (p-value > 0.0001, 95% CI 1.36-2.49) 

```{r}
#| label: tbl-cd-anxiety-soft
#| tbl-cap: "Log-rank test results for anxiety scores and patient-reported flares in CD patients"
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_cd_anx)

test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_cd_anx)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-cd-anxiety-soft
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by anxiety scores in CD patients"
p.cd.anx <- ggsurvplot(fit,
  data = soft_cd_anx,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)
p.cd.anx
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_cd_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    frailty(SiteNo),
  data = soft_cd_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex/fc
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    AgeGroup +
    IMD +
    cat +
    frailty(SiteNo),
  data = soft_cd_anx
)
invisible(cox.summary(cox_model))
```

#### CD depression scores

*	Controlling for site only – significant for moderate depression (p-value =
  0.038, 95% CI 1.02-2.09)
*	Controlling for site, sex and IMD – no significant associations
*	Controlling for site, sex, IMD and FC – no significant associations

```{R}
#| label: tbl-cd-depression-soft
#| tbl-cap: "Log-rank test results for depression scores and patient-reported flares in CD patients"
# depression
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = soft_cd_dep)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_cd_dep
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-cd-depression-soft
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by depression scores in CD patients"
p2 <- ggsurvplot(fit,
  data = soft_cd_dep,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p2
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = soft_cd_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# site/sex/IMD/age
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = soft_cd_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# add FC
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = soft_cd_dep
)

invisible(cox.summary(cox_model))
```
 
### CD and Hard Flares

The table below shows the numbers in each score group at baseline.

```{R}
#| label: tbl-CD-patients
#| tbl-cap: CD Participants within each score group
#table1::table1(~ score_group | hads_type,
#  data = flare_cd,
#  render.continuous = my.render.cont,
#  caption = "CD Participants within each score group"
#)
```


#### CD Anxiety Scores


* No significant increase in risk in any analysis

```{r}
#| label: tbl-cd-anxiety-hard
#| tbl-cap: "Log-rank test results for anxiety scores and hard flares in CD patients"
# CD hard flare, anxiety
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = flare_cd_anx)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = flare_cd_anx
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-cd-anxiety-hard
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by anxiety scores in CD patients"
p3 <- ggsurvplot(fit,
  data = flare_cd_anx,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Anxiety scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#42213D", "#BD4089", "#F51AA4"),
  xlab = "Time from study recruitment (days)"
)
p3
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = flare_cd_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    frailty(SiteNo),
  data = flare_cd_anx
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    cat +
    frailty(SiteNo),
  data = flare_cd_anx
)
invisible(cox.summary(cox_model))
```


#### CD Depression Scores


* No significant increase in risk in any analysis


```{R}
#| label: tbl-cd-depression-hard
#| tbl-cap: "Log-rank test results for depression scores and hard flares in CD patients"
# CD hard flare depression
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group, data = flare_cd_dep)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = flare_cd_dep
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-cd-depression-hard
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by depression scores in CD patients"
p4 <- ggsurvplot(fit,
  data = flare_cd_dep,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-10", "11-21"),
  palette = c("#344055", "#266DD3", "#78CDD7"),
  xlab = "Time from study recruitment (days)"
)
p4
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = flare_cd_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = flare_cd_dep
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = flare_cd_dep
)
invisible(cox.summary(cox_model))
```

## Grouping moderate and severe together to analyse depression scores

Dividing into 2 groups: HADS-Depression 0-7 and 8-21

### Patient-reported flares

* Whole cohort and patient-reported flare:
  * Significant controlling for site only (p-value > 0.0001, 95% CI 1.23-1.86)
  * Significant controlling for site, sex, age, IMD  and age group
    (p-value = 0.0003, 95% CI 1.19-1.81)
  * Significant controlling fo FC additionally (p-value = 0.0002, 95% CI
    1.20-1.84)
* CD only and patient-reported flare:
  * Significantly only when controlling for site only (p-value 0.016, 95% CI
    1.20-1.93)
* UC only and patient-reported flare:
  * Significant controlling for site only (p-value = 0.0013, 95% CI 1.20-2.15)
  * Significant controlling for site, sex, age, IMD (p-value = 0.0015,
    95% CI 1.20-2.16)
  * Significant controlling fo FC additionally (p-value = 0.0008, 95% CI
    1.23-2.23)

```{r, changing cut off score}
# hard flares
hard_dep_grouped_IBD <-
  hardflare_hads[hardflare_hads$hads_type == "depression_hads", ] %>%
  mutate(score_group = case_when(
    score_group %in% c("8-10", "11-21") ~ "8-21",
    TRUE ~ score_group
  ))

hard_dep_grouped_CD <-
  hard_dep_grouped_IBD[hard_dep_grouped_IBD$diagnosis2 == "CD", ]
hard_dep_grouped_UC <-
  hard_dep_grouped_IBD[hard_dep_grouped_IBD$diagnosis2 == "UC/IBDU", ]

# soft flares
soft_dep_grouped_IBD <-
  softflare_hads[softflare_hads$hads_type == "depression_hads", ] %>%
  mutate(score_group = case_when(
    score_group %in% c("8-10", "11-21") ~ "8-21",
    TRUE ~ score_group
  ))

soft_dep_grouped_CD <-
  soft_dep_grouped_IBD[soft_dep_grouped_IBD$diagnosis2 == "CD", ]
soft_dep_grouped_UC <-
  soft_dep_grouped_IBD[soft_dep_grouped_IBD$diagnosis2 == "UC/IBDU", ]
```

```{r}
#| label: tbl-depression-grouped-soft-whole
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and patient-reported flares in whole IBD cohort"
# all IBD soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_dep_grouped_IBD
)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_dep_grouped_IBD
)
test_result %>% pander()
```

```{R}
#| label: fig-km-depression-grouped-soft-whole
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by grouped depression scores (0-7 vs 8-21) in whole IBD cohort"
p5 <- ggsurvplot(fit,
  data = soft_dep_grouped_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#344055", "#266DD3"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = soft_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    frailty(SiteNo),
  data = soft_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    AgeGroup +
    frailty(SiteNo),
  data = soft_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```


```{R}
#| label: tbl-depression-grouped-soft-cd
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and patient-reported flares in CD patients"
# CD soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_dep_grouped_CD
)
test_result <- survdiff(
  Surv(time, DiseaseFlareYN) ~
    score_group,
  data = soft_dep_grouped_CD
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-grouped-soft-cd
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by grouped depression scores (0-7 vs 8-21) in CD patients"
p5 <- ggsurvplot(fit,
  data = soft_dep_grouped_CD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#344055", "#266DD3"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    frailty(SiteNo),
  data = soft_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = soft_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = soft_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{r}
#| label: tbl-depression-grouped-soft-uc
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and patient-reported flares in UC/IBDU patients"
# UC soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_dep_grouped_UC
)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = soft_dep_grouped_UC
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-grouped-soft-uc
#| fig-cap: "Kaplan-Meier survival curves for time to patient-reported flare by grouped depression scores (0-7 vs 8-21) in UC/IBDU patients"
p5 <- ggsurvplot(fit,
  data = soft_dep_grouped_UC,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#344055", "#266DD3"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = soft_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    frailty(SiteNo),
  data = soft_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    AgeGroup +
    frailty(SiteNo),
  data = soft_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

### Hard flares

Time to hard flare for
* Whole cohort (n= 1574, number of events= 217)
  * Statistically significant controlling for site only (p-value = 0.0059,
    95% CI 1.14 - 2.24)
  * Statistically significant controlling for site, sex, IMD, age group
    (p-value = 0.008, 95% CI 1.12-2.22)
  * Statistically significant controlling for FC category additionally (p-value
    = 0.008, 95% CI 1.12-2.22)
* CD only (n= 786, number of events= 98) 
  * Not significant in any analyses
* UC only (n= 771, number of events= 119)
  * Significant controlling for site only (p-value = 0.0015, 95% CI 1.31-3.20)
  * Statistically significant controlling for site, sex, IMD, age group
    (p-value = 0.0005, 95% CI 1.42-3.55)
  * Statistically significant controlling for FC category additionally (p-value
    = 0.00009, 95% CI (1.58-4.02))

```{r}
#| label: tbl-depression-grouped-hard-whole
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and hard flares in whole IBD cohort"
# all IBD soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_IBD
)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_IBD
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-grouped-hard-whole
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by grouped depression scores (0-7 vs 8-21) in whole IBD cohort"
p5 <- ggsurvplot(fit,
  data = hard_dep_grouped_IBD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#6F73D2", "#A3D5FF"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = hard_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    frailty(SiteNo),
  data = hard_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    AgeGroup +
    frailty(SiteNo),
  data = hard_dep_grouped_IBD
)
invisible(cox.summary(cox_model))
```

```{r}
#| label: tbl-depression-grouped-hard-cd
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and hard flares in CD patients"
# all IBD soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_CD
)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_CD
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-grouped-hard-cd
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by grouped depression scores (0-7 vs 8-21) in CD patients"
p5 <- ggsurvplot(fit,
  data = hard_dep_grouped_CD,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#6F73D2", "#A3D5FF"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = hard_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    frailty(SiteNo),
  data = hard_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = hard_dep_grouped_CD
)
invisible(cox.summary(cox_model))
```

```{r}
#| label: tbl-depression-grouped-hard-uc
#| tbl-cap: "Log-rank test results for grouped depression scores (0-7 vs 8-21) and hard flares in UC/IBDU patients"
# all IBD soft flare
fit <- survfit(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_UC
)
test_result <- survdiff(Surv(time, DiseaseFlareYN) ~ score_group,
  data = hard_dep_grouped_UC
)
test_result %>%
  pander()
```

```{R}
#| label: fig-km-depression-grouped-hard-uc
#| fig-cap: "Kaplan-Meier survival curves for time to hard flare by grouped depression scores (0-7 vs 8-21) in UC/IBDU patients"
p5 <- ggsurvplot(fit,
  data = hard_dep_grouped_UC,
  conf.int = TRUE,
  ggtheme = theme_minimal(),
  legend.title = "HADS-Depression scores",
  legend.labs = c("0-7", "8-21"),
  palette = c("#6F73D2", "#A3D5FF"),
  xlab = "Time from study recruitment (days)"
)
p5
```

```{R}
#| output: "asis"
# site only
cox_model <- coxph(Surv(time, DiseaseFlareYN) ~ score_group + frailty(SiteNo),
  data = hard_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 2
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    AgeGroup +
    frailty(SiteNo),
  data = hard_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

```{R}
#| output: "asis"
# analysis 3 (FC)
cox_model <- coxph(
  Surv(time, DiseaseFlareYN) ~
    score_group +
    Sex +
    IMD +
    cat +
    frailty(SiteNo),
  data = hard_dep_grouped_UC
)
invisible(cox.summary(cox_model))
```

## Reproduction and reproducibility {.appendix}

<details class = "appendix">
  <summary> Session info </summary>

```{R Session info}
#| echo: false
pander::pander(sessionInfo())
```

</details>

Licensed by 
<a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a>
 unless otherwise stated.
