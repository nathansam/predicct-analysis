---
title: "Diet"
author:
  - name: "Nathan Constantine-Cooke"
    corresponding: true
    url: https://scholar.google.com/citations?user=2emHWR0AAAAJ&hl=en&oi=ao
    affiliations:
      - ref: CGEM
      - ref: HGU
bibliography: Baseline.bib   
---

## Introduction

```{R}
set.seed(123)

##############
## Packages ##
##############

library(plyr) # Used for mapping values
suppressPackageStartupMessages(library(tidyverse)) # ggplot2, dplyr, and magrittr
library(readxl) # Read in Excel files
library(lubridate) # Handle dates
library(datefixR) # Standardise dates
library(patchwork) # Arrange ggplots

# Generate tables
suppressPackageStartupMessages(library(table1))
library(knitr)
library(pander)

# Generate flowchart of cohort derivation
library(DiagrammeR)
library(DiagrammeRsvg)

# paths to PREdiCCt data
if (file.exists("/docker")) { # If running in docker
  data.path <- "data/final/20221004/"
  redcap.path <- "data/final/20231030/"
  upf.path <- "data/final/20240924/"
  prefix <- "data/end-of-follow-up/"
  outdir <- "data/processed/"
} else { # Run on OS directly
  data.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20221004/"
  redcap.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20231030/"
  upf.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20240924/"
  prefix <- "/Volumes/igmm/cvallejo-predicct/predicct/end-of-follow-up/"
  outdir <- "/Volumes/igmm/cvallejo-predicct/predicct/processed/"
}

demo <- readRDS(paste0(outdir, "demo-biochem.RDS"))

FFQ <- read_xlsx(paste0(
  prefix,
  "predicct ffq_nutrientfood groupDQI all foods_data (n1092)Nov2022.xlsx"
))

FFQ$meat_overall <- rowSums(FFQ[, paste0("meat7", letters[1:12], "_grams")])

FFQ$fish_overall <- rowSums(FFQ[, paste0("fish8", letters[1:13], "_grams")])

FFQ$ParticipantNo <- FFQ$participantno
demo <- merge(demo,
  FFQ[, c(
    "ParticipantNo",
    "Meat_sum",
    "meat_overall",
    "fish_overall",
    "fibre",
    "PUFA_percEng",
    "NOVAScore_cat",
    "dqi_tot"
  )],
  by = "ParticipantNo",
  all.x = TRUE,
  all.y = FALSE
)
```


```{R}
# library(writexl)
# FFQ <- merge(FFQ,
#  demo[, c("ParticipantNo", "FC", "Sex", "diagnosis2")],
#  by = "ParticipantNo",
#  all.x = TRUE,
#  all.y = FALSE
# )

# FFQ <- subset(FFQ, !is.na(FC))
# write_xlsx(FFQ, paste0("/Volumes/igmm/cvallejo-predicct/predicct/processed/", "FFQ-FC.xlsx"))
```

PREdiCCt has collected data on diet via food frequency questionnaires (FFQs) and
food diaries. This dietary data has been analysed by staff at the
[University of Aberdeen](https://www.abdn.ac.uk/), primarily by
[Dr Janet Kyle](https://www.abdn.ac.uk/iahs/profiles/j.kyle), 
[Dr Graham Horgan](https://www.bioss.ac.uk/people/graham), and
[Professor Alex Johnstone](https://www.abdn.ac.uk/rowett/research/profiles/alex.johnstone).

Whilst data for many dietary variables have been collected, this report
will focus on the data outlined in the SAP.

1. Protein from animal-sources
1. Dietary fibre
1. Polyunsaturated fatty acids (PUFAs)
1. Nova intake score

The data for these variables were extracted from the FFQs. As reported
associations between dietary data and IBD are often specific to a form of IBD
rather than IBD as a whole, these data will be presented stratified by disease
type. 

## Protein from meat sources

@fig-meat-sum-dist suggests there are relatively few vegetarians in the PREdiCCt
cohort. Whilst some extreme values were observed for protein from meat sources,
they remain plausible. 

```{R}
#| label: fig-meat-sum-dist
#| fig-cap: "Distribution of protein intake from meat."
#| warning: false
demo %>%
  drop_na(Meat_sum) %>%
  ggplot(aes(x = Meat_sum, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Protein from meat sources (g)",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

No association was observed between protein intake from meat and FC in either CD
or UC.

```{R}
#| label: tbl-meat-sum-cd
#| tbl-cap: "ANOVA between protein intake from meat and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = Meat_sum ~ cat) %>%
  summary() %>%
  pander()
```

```{R}
#| label: tbl-meat-sum-uc
#| tbl-cap: "ANOVA between protein intake from meat and FC groups in UC/IBDU."

demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = Meat_sum ~ cat) %>%
  summary() %>%
  pander()
```

## Overall meat intake

```{R}
#| label: fig-meat-overall-dist
#| fig-cap: "Distribution of overall meat intake."
#| warning: false
demo %>%
  drop_na(meat_overall) %>%
  ggplot(aes(x = meat_overall, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Meat intake (g)",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

No association was observed between meat intake and FC in CD. However, a
significant association was observed between meat intake and FC in UC/IBDU
[@tbl-meat-overall-uc].

```{R}
#| label: tbl-meat-overall-cd
#| tbl-cap: "ANOVA between meat intake and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = meat_overall ~ cat) %>%
  summary() %>%
  pander()
```



```{R}
#| label: tbl-meat-overall-uc
#| tbl-cap: "ANOVA between meat intake and FC groups in UC/IBDU."
demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = meat_overall ~ cat) %>%
  summary() %>%
  pander()
```

## Overall fish intake

```{R}
#| label: fig-fish-overall-dist
#| fig-cap: "Distribution of overall fish intake."
#| warning: false
demo %>%
  drop_na(fish_overall) %>%
  ggplot(aes(x = fish_overall, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Fish intake (g)",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    labels = c("UC/IBDU", "Crohn's"),
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

No association was observed between meat intake and FC in CD. However, a
significant association was observed between meat intake and FC in UC/IBDU
[@tbl-meat-overall-uc].

```{R}
#| label: tbl-fish-overall-cd
#| tbl-cap: "ANOVA between fish intake and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = fish_overall ~ cat) %>%
  summary() %>%
  pander()
```



```{R}
#| label: tbl-fish-overall-uc
#| tbl-cap: "ANOVA between fish intake and FC groups in UC/IBDU."
demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = fish_overall ~ cat) %>%
  summary() %>%
  pander()
```

## Dietary fibre

Fibre has frequently investigated as a potential factor in IBD pathogenesis,
particularly in CD. 

A study of 170,776 women across 26 years found fibre
intake, particularly fibre derived from fruits, to be low for incident CD
patients [@ananthakrishnan_2013].

A US study of 1,130 CD subjects found CD patients who reported that they did not
avoid high-fibre foods were approximately 40\% less likely to have a disease
flare in a 6-month period than those who avoided high-fibre foods
[@brotherton_2016].

There is less evidence of a relationship between UC and dietary fibre.  

There does not appear to be substantial differences in fibre between CD and
UC/IBDU PREdiCCt participants. 

```{R}
#| label: fig-fibre-dist
#| fig-cap: "Distribution of dietary fibre."
#| warning: false
demo %>%
  drop_na(fibre) %>%
  ggplot(aes(x = fibre, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Dietary fibre",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

No association was found between dietary fibre intake and FC. 

```{R}
#| label: tbl-fibre-cd
#| tbl-cap: "ANOVA between dietary fibre and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = fibre ~ cat) %>%
  summary() %>%
  pander()
```

```{R}
#| label: tbl-fibre-uc
#| tbl-cap: "ANOVA between dietary fibre and FC groups in UC/IBDU."

demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = fibre ~ cat) %>%
  summary() %>%
  pander()
```

## Polyunsaturated fatty acids

PUFAs exhibit anti-inflammatory properties and there is evidence of a
relationship between PUFAs and UC incidence [@Marion_Letellier_2013]. Research
suggests that a diet with a poor balance of n-3 and n-6 PUFAs, commonly seen in
"Western" diets is associated with IBD risk. 

The PREdiCCt SAP states n-6 PUFAs will be examined. However, the data obtained
from the FFQs describes PUFAs as a whole (including n-3 PUFAs).


```{R}
#| label: fig-pufa-dist
#| fig-cap: "Distribution of polyunsaturated fatty acids."
#| warning: false
demo %>%
  drop_na(cat) %>%
  ggplot(aes(x = PUFA_percEng, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "PUFA intake",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

A significant association was not seen between PUFA intake and FC. 

```{R}
#| label: tbl-pufa-cd
#| tbl-cap: "ANOVA between polyunsaturated fatty acids and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = PUFA_percEng ~ cat) %>%
  summary() %>%
  pander()
```


```{R}
#| label: tbl-pufa-uc
#| tbl-cap: "ANOVA between polyunsaturated fatty acids and FC groups in UC/IBDU."

demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = PUFA_percEng ~ cat) %>%
  summary() %>%
  pander()
```

## Diet qualiy index

```{R}
demo %>%
  drop_na(cat) %>%
  ggplot(aes(x = dqi_tot, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Diet quality index",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

```{R}
#| label: tbl-dqi-cd
#| tbl-cap: "ANOVA between diet quality index and FC groups in Crohn's disease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = dqi_tot ~ cat) %>%
  summary() %>%
  pander()
```

```{R}
#| label: tbl-dqi-uc
#| tbl-cap: "ANOVA between diet quality index and FC groups in UC/IBDU."

demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = dqi_tot ~ cat) %>%
  summary() %>%
  pander()
```

## Nova intake score

There has been a great deal of recent research interest in ultra processed food
(UPF) and IBD. For example, @Narula_2021 found UPF intake to be positively
associated with IBD risk. 

The Nova score is a popular approach for classifying UPFs [@Monteiro_2017]. Food
is classified as either unprocessed, processed culinary, processed food, or
ultra-processed via the Nova score. The University of Aberdeen have developed an
extension of the Nova score, the Nova intake score, which can be used to
categorise individuals and their diets instead of individual food items.

The following definition of the Nova intake score was written by Liam McAdie 
during a 5th year medical elective in which he worked on the PREdiCCt dietary
data. The formulae have received minor modifications, but otherwise the
definitions remain unchanged from McAdie's work. 

### Definition

When completing the FFQ, participants were asked to report ($a$) portion size
normally consumed, ($b$) number of times this portion is consumed in one day and
($c$) number of days per week food type is consumed. Participant’s daily average
consumption (in grams) of a food and drink type ($x$) was calculated by:

$$
x=\frac{c}{7}(a+b)
$$

Standardised number of portions consumed daily for food and drink type ($y$) was
calculated by dividing consumption ($x$) by the Foods Standard Agency average
UK-portion size ($z$). 

$$
y= \frac{x}{z}
$$

Nova intake scores ($N$) were calculated by multiplying the number of
standardised portions consumed ($y$) by their corresponding Nova score ($M$)
assigned in the database. This process is repeated for all 169 food and drink
types and totalled to give one overall Nova intake score. This score is a marker
representative of UPF intake.

$$
N = \sum_{i = 1}^{169} (y_i M_i)
$$

### Results

The distribution of Nova intake score appears to be uniform across the cohort,
as such, it seems likely that these data have been mapped to quantiles and are
no longer describing Nova Score categories. 

```{R}
#| label: fig-novas-dist
#| fig-cap: "Distribution of Nova intake scores."
demo$NOVAScore_cat <- factor(demo$NOVAScore_cat,
  levels = 1:4,
  labels = c(
    "Unprocessed",
    "Processed culinary",
    "Procesed food",
    "Ultra-processed"
  )
)

demo %>%
  drop_na(NOVAScore_cat) %>%
  ggplot(aes(x = NOVAScore_cat, color = diagnosis2, fill = diagnosis2)) +
  geom_bar() +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "Nova intake score",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

No significant association was observed between Nova intake scores and FC
groups. 

```{R}
#| tbl-cap: "Chi-squared test between Nova intake score and FC groups in Crohn's disease."

temp <- demo %>%
  filter(diagnosis2 == "CD")

pander(chisq.test(temp$NOVAScore_cat, temp$cat))
```

```{R}
#| tbl-cap: "Chi-squared test between Nova intake score and FC groups in UC/IBDU."

temp <- demo %>%
  filter(diagnosis2 == "UC/IBDU")

pander(chisq.test(temp$NOVAScore_cat, temp$cat))
```

### Percentage of energy intake

```{R}
nova4 <- read_xlsx(paste0(upf.path, "NOVA4Scores.xlsx"))
colnames(nova4)[c(1, 6)] <- c("ParticipantNo", "UPF_perc")
demo <- merge(demo,
  nova4[, c("ParticipantNo", "UPF_perc")],
  by = "ParticipantNo",
  all.x = TRUE,
  all.y = FALSE
)
```

As an alternative to the above analyses, we have also explored the percentage of
daily energy intake which is derived from ultra processed (UPF4) groups. 

```{R}
#| label: fig-upfperc-dist
#| fig-cap: "Distribution of the percentage of daily energy intake sourced from UPF (Nova score 4) food and drink."
demo %>%
  drop_na(cat) %>%
  ggplot(aes(x = UPF_perc, color = diagnosis2, fill = diagnosis2)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    x = "% of energy intake attributed to Nova 4 food and drink",
    y = "Frequency",
    color = "IBD type",
    fill = "IBD type"
  ) +
  scale_fill_manual(
    values = c("#CDEDF6", "#FF6B6B")
  ) +
  scale_color_manual(
    values = c("#5EB1BF", "#C24343")
  ) +
  facet_grid(rows = vars(diagnosis2))
```

```{R}
#| label: tbl-upfperc-cd
#| tbl-cap: "ANOVA between Nova 4 food as a percentage of energy intake and FC for Crohn's diseease."

demo %>%
  filter(diagnosis2 == "CD") %>%
  aov(formula = UPF_perc ~ cat) %>%
  summary() %>%
  pander()
```


```{R}
#| label: tbl-upfperc-uc
#| tbl-cap: "ANOVA between Nova 4 food as a percentage of energy intake and FC for UC/IBDU."

demo %>%
  filter(diagnosis2 == "UC/IBDU") %>%
  aov(formula = UPF_perc ~ cat) %>%
  summary() %>%
  pander()
```




```{R}
saveRDS(demo, paste0(outdir, "demo-diet.RDS"))
```

## Comparison

@fig-diet-dist presents macronutrient, PUFA and UPF intake as percentages of
total energy intake.

```{R}
#| label: fig-diet-dist
#| fig-cap: "Dietary distribution of the FFQ subcohort expressed as percentages of energy intake and stratified by sex and diagnosis of either Crohn’s disease or ulcerative colitis/inflammatory bowel disease unclassified."
#| warning: false
#| fig-width: 8
FFQ$Prot_percEng <- ((FFQ$Protng * 4) / FFQ$EnergykCAL) * 100

FFQ <- merge(FFQ,
  nova4[, c("ParticipantNo", "UPF_perc")],
  by = "ParticipantNo",
  all.x = TRUE,
  all.y = FALSE
)


comparison <- reshape2::melt(FFQ,
  id.vars = "ParticipantNo",
  measure.vars = c(
    "CHO_percEng",
    "Fat_percEng",
    "Prot_percEng",
    "SatFat_percEng",
    "PUFA_percEng",
    "UPF_perc"
  )
)

comparison <- merge(comparison,
  demo[, c("ParticipantNo", "Sex", "diagnosis2")],
  by = "ParticipantNo",
  all.x = TRUE,
  all.y = FALSE
)

p <- ggplot(
  comparison,
  aes(color = variable, fill = variable, y = value, x = Sex)
) +
  geom_violin() +
  facet_grid(~diagnosis2,
    scales = "free_x",
    space = "free_x",
    switch = "x"
  ) +
  theme_minimal() +
  theme(
    strip.placement = "outside",
    strip.background = element_rect(fill = "white"),
    strip.clip = "on",
    axis.title.x = element_blank(),
    legend.position = "bottom"
  ) +
  scale_fill_manual(
    values = c(
      "#4F359B",
      "#FFED49",
      "#2EC4B6",
      "#E71D36",
      "#FF9F1C",
      "#80BF56"
    ),
    labels = c(
      "Carbohydrate",
      "Fat",
      "Protein",
      "Saturated fat",
      "Polyunsaturated fatty acids",
      "Ultra-processed foods"
    )
  ) +
  scale_color_manual(
    values = c(
      "#392376",
      "#ADA009",
      "#00877C",
      "#9F1C29",
      "#B06B01",
      "#568238"
    ),
    labels = c(
      "Carbohydrate",
      "Fat",
      "Protein",
      "Saturated fat",
      "Polyunsaturated fatty acids",
      "Ultra-processed food"
    )
  ) +
  labs(
    y = "% of total energy intake",
    color = "",
    fill = ""
  ) +
  guides(
    colour = guide_legend(nrow = 1),
    fill = guide_legend(nrow = 1)
  )

ggsave("plots/baseline/diet.png", p, width = 12 * 0.8, height = 7 * 0.8)
ggsave("plots/baseline/diet.pdf", p, width = 12 * 0.8, height = 7 * 0.8)
p
```

## Reproduction and reproducibility {.appendix}

<details class = "appendix">
  <summary> Session info </summary>

```{R Session info}
#| echo: false
pander::pander(sessionInfo())
```

</details>

Licensed by 
<a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a>
 unless otherwise stated.
