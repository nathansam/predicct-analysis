---
title: "Quality of Life - SF12"
author: "Chiara Cotronei"
date: "2024-03-27"
output:
  html_document:
    self_contained: yes
    code_folding: hide
  pdf_document: default
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE, error = FALSE, warning = TRUE)
```

```{r load libraries, warn.conflicts = FALSE}
set.seed(123)
library(plyr) # Used for mapping values
suppressPackageStartupMessages(library(tidyverse)) # ggplot2, dplyr, and magrittr
library(readxl) # Read in Excel files
library(datefixR) # Standardise dates  
library(openxlsx)
library(tidyr)
library(ggdist)
library(rstatix)

suppressPackageStartupMessages(library(table1))
library(knitr)
library(pander)
library(kableExtra)

# Generate flowchart of cohort derivation
library(DiagrammeR)
library(DiagrammeRsvg)

#cox-regression
library(survival)
library(survminer)
library(finalfit)

```

```{r access to data}
# paths to PREdiCCt data
if (file.exists("/.dockerenv")) {
  # If running in docker
  data.path <- "data/final/20221004/"
  redcap.path <- "data/final/20231030/"
  prefix <- "data/end-of-follow-up/"
  outdir <- "data/processed"
  save_path <- "people/chiara/"
} else {
  # Run on OS directly
  data.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20221004/"
  redcap.path <- "/Volumes/igmm/cvallejo-predicct/predicct/final/20231030/"
  prefix <- "/Volumes/igmm/cvallejo-predicct/predicct/end-of-follow-up/"
  outdir <- "/Volumes/igmm/cvallejo-predicct/predicct/processed/"
  save_path <- "/Volumes/igmm/cvallejo-predicct/people/chiara/"
}
```

```{r load data}
#read-in data
#hads is question 42 of the baseline questionnaire
lifeevents <- read.xlsx(paste0(data.path, "Baseline2022/lifeevents.xlsx"))
demographics <- read.xlsx(paste0(data.path, "Baseline2022/demographics2022.xlsx"))
demo <- readRDS("/Volumes/igmm/cvallejo-predicct/predicct/processed/demo.RDS")
IBD <- read.xlsx(paste0(data.path, "Baseline2022/IBD.xlsx"))
QOL <- read.xlsx(paste0(data.path, "Baseline2022/health.xlsx"))
```


# Quality of life 

The SF12 provides two scores: the PSC12 and the MCS12 which give a score (0-100) where higher scores equal better quality of life. The PSC12 is calculated by domains reflecting physical function, and the MCS12 reflects mental function.

Of note, in the PREdiCCt questionnaire, 4/6 questions pertaining to mental health were scored out of 5 options instead of 6 as per the SF12. I have coded to reflect that option 4 ("some of the time") was never selected, and believe this to have influenced the distribution of MCS12 scores (see distribution graph below). However, this should not affect comparison between groups within th PREdiCCt cohort. 

```{r, clean QOL as per PREdiCCt paper 2 standard}
QOL <- QOL %>% 
  filter(!is.na(ParticipantNo))
QOL <- QOL %>% 
  left_join(demographics %>% select(ParticipantNo, Sex, age, diagnosis), by  = "ParticipantNo")
QOL <- QOL[QOL$age > 17,]
QOL$diagnosis2 <- plyr::mapvalues(QOL$diagnosis,
  from = seq(1, 4),
  to = c(1, 2, 2, 2)
) %>%
  factor(levels = c("1", "2"), labels = c("CD", "UC/IBDU"))
QOL$Sex <- factor(QOL$Sex, levels = c(1, 2), labels = c("Male", "Female"))
QOL$AgeGroup <- cut(QOL$age, 
                         breaks = c(18, 24, 34, 44, 54, 65, Inf), 
                         labels = c("18-24", "25-34", "35-44", "45-54", "55-64", "65+"),
                         include.lowest = TRUE)

#adding flare, FC, IMD and smoking data
QOL <- QOL %>% 
  left_join(IBD %>% select(ParticipantNo, FlaresInPastYear)) %>% 
  filter(!is.na(FlaresInPastYear)) %>% 
  mutate(flare_group = ifelse(FlaresInPastYear == 0, "No Flares", "1 or More Flares"))
QOL$flare_group <- factor(QOL$flare_group, levels = c( "No Flares", "1 or More Flares"))
QOL <- QOL %>% 
  left_join(demo %>% select(ParticipantNo, FC, cat, IMD)) %>% 
  filter(!is.na(cat))

#Checkmissingdata - 53 
missing_QOL <- QOL %>% 
  filter(rowSums(is.na(select(., 7:18))) > 0)
#exclude missing
QOL <- QOL %>%
  filter(!rowSums(is.na(select(., 7:18))) > 0)
```


Methods

Coded according to SF12 guidance which weighs each item response differently. 
Some code used taken from github https://github.com/lbraglia/lbscorer/blob/master/R/sf12.R.

Join demographics data and demo (FC data)
Remove missing Participant No, <18y/o, missing FC
Check for missing data - exclude if missing answers (n=53)
Check for data out of range (done manaully):

* GeneralHealth - nil out of range
* ModerateActivities - nil out of range
* ClimbingStairs - nil out of range
* PhysicalAccomplishedLess - nil out of range
* PhysicalLimitedKindWork - nil out of range
* EmotionalAccomplishedLess - nil out of range
* EmotionalNotCarefulAsUsual - nil out of range
* PainInterfere - nil out of range
* CalmAndPeaceful - nil out of range
* LotOfEnergy - nil out of range
* DownheartedBlue - nil out of range

To account for missing option ("some of the time") recode:

* CalmAndPeaceful 4=5 and 5=6
* LotOfEnergy 4=5 and 5=6
* DownheartedBlue 4=5 and 5=6
* SocialActivities 4=5 and 5=6


Reverse code: GeneralHealth, PainInterfere, CalmAndPeaceful, DownheartedBlue

```{r, reverse code as per protocol}
#recode to account for missing "sometimes" option
QOL <- QOL %>%
  mutate_at(vars(CalmAndPeaceful, LotOfEnergy, DownheartedBlue, SocialActivities),
            ~ if (any(. == 4)) {
                  ifelse(. == 4, 5, ifelse(. == 5, 6, .))
               } else {
                  .
               })
#Reverse code GeneralHealth, PainInterfere, CalmAndPeaceful, DownheartedBlue
QOL <- QOL %>%
  mutate_at(vars(CalmAndPeaceful, DownheartedBlue),
            ~ if (any(. %in% 1:6)) {
                  7 - . 
               } else {
                  .
               })

QOL <- QOL %>% 
    mutate_at(vars(GeneralHealth, PainInterfere),
            ~ if (any(. %in% 1:5)) {
                  6 - . 
               } else {
                  .
               })
```

```{r, rename for ease of anaysis}
QOL <- QOL %>% 
  rename(gh1 = GeneralHealth, 
         pf02 = ModerateActivities, 
         pf04 = ClimbingStairs, 
         rp2 = PhysicalAccomplishedLess, 
         rp3 = PhysicalLimitedKindWork, 
         re2 = EmotionalAccomplishedLess, 
         re3 = EmotionalNotCarefulAsUsual, 
         bp2 = PainInterfere, 
         mh3 = CalmAndPeaceful, 
         vt2 = LotOfEnergy, 
         mh4 = DownheartedBlue, 
         sf2 = SocialActivities)
```

```{r, coding of SF12}

  
    ## PF02_1 = .;
  ##   if PF02 = . then PF02_1 = .; else
  ##   if PF02 = 1 then PF02_1 = 1; else PF02_1 = 0;
  ## PF02_2 = .;
  ##   if PF02 = . then PF02_2 = .; else
  ##   if PF02 = 2 then PF02_2 = 1; else PF02_2 = 0;

  QOL$pf02_1 <- as.numeric(QOL$pf02 == 1L) 
  QOL$pf02_2 <- as.numeric(QOL$pf02 == 2L) 
  
  ## PF04_1 = .;
  ##   if PF04 = . then PF04_1 = .; else
  ##   if PF04 = 1 then PF04_1 = 1; else PF04_1 = 0;
  ## PF04_2 = .;
  ##   if PF04 = . then PF04_2 = .; else
  ##   if PF04 = 2 then PF04_2 = 1; else PF04_2 = 0;

  QOL$pf04_1 <- as.numeric(QOL$pf04 == 1L) 
  QOL$pf04_2 <- as.numeric(QOL$pf04 == 2L) 

  ## RP2_1 = .;
  ##   if RP2 = . then RP2_1 = .; else
  ##   if RP2 = 1 then RP2_1 = 1; else RP2_1 = 0;

  QOL$rp2_1 <- as.numeric(QOL$rp2 == 1L) 

  ## RP3_1 = .;
  ##   if RP3 = . then RP3_1 = .; else
  ##   if RP3 = 1 then RP3_1 = 1; else RP3_1 = 0;

  QOL$rp3_1 <- as.numeric(QOL$rp3 == 1L) 

  ## BP2_1 = .;
  ##   if BP2 = . then BP2_1 = .; else
  ##   if BP2 = 1 then BP2_1 = 1; else BP2_1 = 0;
  ## BP2_2 = .;
  ##   if BP2 = . then BP2_2 = .; else
  ##   if BP2 = 2 then BP2_2 = 1; else BP2_2 = 0;
  ## BP2_3 = .;
  ##   if BP2 = . then BP2_3 = .; else
  ##   if BP2 = 3 then BP2_3 = 1; else BP2_3 = 0;
  ## BP2_4 = .;
  ##   if BP2 = . then BP2_4 = .; else
  ##   if BP2 = 4 then BP2_4 = 1; else BP2_4 = 0;

  QOL$bp2_1 <- as.numeric(QOL$bp2 == 1L) 
  QOL$bp2_2 <- as.numeric(QOL$bp2 == 2L) 
  QOL$bp2_3 <- as.numeric(QOL$bp2 == 3L) 
  QOL$bp2_4 <- as.numeric(QOL$bp2 == 4L) 

  ## GH1_1 = .;
  ##   if GH1 = . then GH1_1 = .; else
  ##   if GH1 = 1 then GH1_1 = 1; else GH1_1 = 0;
  ## GH1_2 = .;
  ##   if GH1 = . then GH1_2 = .; else
  ##   if GH1 = 2 then GH1_2 = 1; else GH1_2 = 0;
  ## GH1_3 = .;
  ##   if GH1 = . then GH1_3 = .; else
  ##   if GH1 = 3 then GH1_3 = 1; else GH1_3 = 0;
  ## GH1_4 = .;
  ##   if GH1 = . then GH1_4 = .; else
  ##   if GH1 = 4 then GH1_4 = 1; else GH1_4 = 0;

  QOL$gh1_1 <- as.numeric(QOL$gh1 == 1L) 
  QOL$gh1_2 <- as.numeric(QOL$gh1 == 2L) 
  QOL$gh1_3 <- as.numeric(QOL$gh1 == 3L) 
  QOL$gh1_4 <- as.numeric(QOL$gh1 == 4L) 

  ## VT2_1 = .;
  ##   if VT2 = . then VT2_1 = .; else
  ##   if VT2 = 1 then VT2_1 = 1; else VT2_1 = 0;
  ## VT2_2 = .;
  ##   if VT2 = . then VT2_2 = .; else
  ##   if VT2 = 2 then VT2_2 = 1; else VT2_2 = 0;
  ## VT2_3 = .;
  ##   if VT2 = . then VT2_3 = .; else
  ##   if VT2 = 3 then VT2_3 = 1; else VT2_3 = 0;
  ## VT2_4 = .;
  ##   if VT2 = . then VT2_4 = .; else
  ##   if VT2 = 4 then VT2_4 = 1; else VT2_4 = 0;
  ## VT2_5 = .;
  ##   if RVT2 = . then VT2_5 = .; else
  ##   if RVT2 = 5 then VT2_5 = 1; else VT2_5 = 0;
  
  QOL$vt2_1 <- as.numeric(QOL$vt2 == 1L) 
  QOL$vt2_2 <- as.numeric(QOL$vt2 == 2L) 
  QOL$vt2_3 <- as.numeric(QOL$vt2 == 3L) 
  QOL$vt2_4 <- as.numeric(QOL$vt2 == 4L) 
  QOL$vt2_5 <- as.numeric(QOL$vt2 == 5L) 

  ## SF2_1 = .;
  ##   if SF2 = . then SF2_1 = .; else
  ##   if SF2 = 1 then SF2_1 = 1; else SF2_1 = 0;
  ## SF2_2 = .;
  ##   if SF2 = . then SF2_2 = .; else
  ##   if SF2 = 2 then SF2_2 = 1; else SF2_2 = 0;
  ## SF2_3 = .;
  ##   if SF2 = . then SF2_3 = .; else
  ##   if SF2 = 3 then SF2_3 = 1; else SF2_3 = 0;
  ## SF2_4 = .;
  ##   if SF2 = . then SF2_4 = .; else
  ##   if SF2 = 4 then SF2_4 = 1; else SF2_4 = 0;

  QOL$sf2_1 <- as.numeric(QOL$sf2 == 1L) 
  QOL$sf2_2 <- as.numeric(QOL$sf2 == 2L) 
  QOL$sf2_3 <- as.numeric(QOL$sf2 == 3L) 
  QOL$sf2_4 <- as.numeric(QOL$sf2 == 4L) 

  ## RE2_1 = .;
  ##   if RE2 = . then RE2_1 = .; else
  ##   if RE2 = 1 then RE2_1 = 1; else RE2_1 = 0;

  QOL$re2_1 <- as.numeric(QOL$re2 == 1L) 

  ## RE3_1 = .;
  ##   if RE3 = . then RE3_1 = .; else
  ##   if RE3 = 1 then RE3_1 = 1; else RE3_1 = 0;

  QOL$re3_1 <- as.numeric(QOL$re3 == 1L) 

  ## MH3_1 = .;
  ##   if RMH3 = . then MH3_1 = .; else
  ##   if RMH3 = 1 then MH3_1 = 1; else MH3_1 = 0;
  ## MH3_2 = .;
  ##   if RMH3 = . then MH3_2 = .; else
  ##   if RMH3 = 2 then MH3_2 = 1; else MH3_2 = 0;
  ## MH3_3 = .;
  ##   if RMH3 = . then MH3_3 = .; else
  ##   if RMH3 = 3 then MH3_3 = 1; else MH3_3 = 0;
  ## MH3_4 = .;
  ##   if RMH3 = . then MH3_4 = .; else
  ##   if RMH3 = 4 then MH3_4 = 1; else MH3_4 = 0;
  ## MH3_5 = .;
  ##   if RMH3 = . then MH3_5 = .; else
  ##   if RMH3 = 5 then MH3_5 = 1; else MH3_5 = 0;

  QOL$mh3_1 <- as.numeric(QOL$mh3 == 1L) 
  QOL$mh3_2 <- as.numeric(QOL$mh3 == 2L) 
  QOL$mh3_3 <- as.numeric(QOL$mh3 == 3L) 
  QOL$mh3_4 <- as.numeric(QOL$mh3 == 4L) 
  QOL$mh3_5 <- as.numeric(QOL$mh3 == 5L) 

  ## MH4_1 = .;
  ##   if MH4 = . then MH4_1 = .; else
  ##   if MH4 = 1 then MH4_1 = 1; else MH4_1 = 0;
  ## MH4_2 = .;
  ##   if MH4 = . then MH4_2 = .; else
  ##   if MH4 = 2 then MH4_2 = 1; else MH4_2 = 0;
  ## MH4_3 = .;
  ##   if MH4 = . then MH4_3 = .; else
  ##   if MH4 = 3 then MH4_3 = 1; else MH4_3 = 0;
  ## MH4_4 = .;
  ##   if MH4 = . then MH4_4 = .; else
  ##   if MH4 = 4 then MH4_4 = 1; else MH4_4 = 0;
  ## MH4_5 = .;
  ##   if MH4 = . then MH4_5 = .; else
  ##   if MH4 = 5 then MH4_5 = 1; else MH4_5 = 0;

  QOL$mh4_1 <- as.numeric(QOL$mh4 == 1L) 
  QOL$mh4_2 <- as.numeric(QOL$mh4 == 2L) 
  QOL$mh4_3 <- as.numeric(QOL$mh4 == 3L) 
  QOL$mh4_4 <- as.numeric(QOL$mh4 == 4L) 
  QOL$mh4_5 <- as.numeric(QOL$mh4 == 5L) 
  

  ## *****************************************************************;
  ## *               STEP 3: WEIGHTING AND AGGREGATION OF            *
  ## *                       INDICATOR VARIABLES USING               *
  ## *                       PHYSICAL AND MENTAL REGRESSION WEIGHTS  *
  ## *****************************************************************;
  ## RAWPCS12 = (-7.23216*PF02_1) + (-3.45555*PF02_2) +
  ##   (-6.24397*PF04_1) + (-2.73557*PF04_2) + (-4.61617*RP2_1) +
  ##   (-5.51747*RP3_1) + (-11.25544*BP2_1) + (-8.38063*BP2_2) +
  ##   (-6.50522*BP2_3) + (-3.80130*BP2_4) + (-8.37399*GH1_1) +
  ##   (-5.56461*GH1_2) + (-3.02396*GH1_3) + (-1.31872*GH1_4) +
  ##   (-2.44706*VT2_1) + (-2.02168*VT2_2) + (-1.6185*VT2_3) +
  ##   (-1.14387*VT2_4) + (-0.42251*VT2_5) + (-0.33682*SF2_1) +
  ##   (-0.94342*SF2_2) + (-0.18043*SF2_3) + (0.11038*SF2_4) +
  ##   (3.04365*RE2_1) + (2.32091*RE3_1) + (3.46638*MH3_1) +
  ##   (2.90426*MH3_2) + (2.37241*MH3_3) + (1.36689*MH3_4) +
  ##   (0.66514*MH3_5) + (4.61446*MH4_1) + (3.41593*MH4_2) +
  ##   (2.34247*MH4_3) + (1.28044*MH4_4) + (0.41188*MH4_5);

  ## RAWMCS12 = (3.93115*PF02_1) + (1.8684*PF02_2) +
  ##   (2.68282*PF04_1) + (1.43103*PF04_2) + (1.4406*RP2_1) +
  ##   (1.66968*RP3_1) + (1.48619*BP2_1) + (1.76691*BP2_2) +
  ##   (1.49384*BP2_3) + (0.90384*BP2_4) + (-1.71175*GH1_1) +
  ##   (-0.16891*GH1_2) + (0.03482*GH1_3) + (-0.06064*GH1_4) +
  ##   (-6.02409*VT2_1) + (-4.88962*VT2_2) + (-3.29805*VT2_3) +
  ##   (-1.65178*VT2_4) + (-0.92057*VT2_5) + (-6.29724*SF2_1) +
  ##   (-8.26066*SF2_2) + (-5.63286*SF2_3) + (-3.13896*SF2_4) +
  ##   (-6.82672*RE2_1) + (-5.69921*RE3_1) + (-10.19085*MH3_1) +
  ##   (-7.92717*MH3_2) + (-6.31121*MH3_3) + (-4.09842*MH3_4) +
  ##   (-1.94949*MH3_5) + (-16.15395*MH4_1) + (-10.77911*MH4_2) +
  ##   (-8.09914*MH4_3) + (-4.59055*MH4_4) + (-1.95934*MH4_5);

QOL <- QOL %>% 
  mutate(RAWPCS12 =
                   (-7.23216*pf02_1) + (-3.45555*pf02_2) +
                   (-6.24397*pf04_1) + (-2.73557*pf04_2) +
                   (-4.61617*rp2_1) + 
                   (-5.51747*rp3_1) +
                   (-11.25544*bp2_1) + (-8.38063*bp2_2) +
                   (-6.50522*bp2_3) + (-3.80130*bp2_4) + (-8.37399*gh1_1) +
                   (-5.56461*gh1_2) + (-3.02396*gh1_3) + (-1.31872*gh1_4) +
                   (-2.44706*vt2_1) + (-2.02168*vt2_2) + (-1.6185*vt2_3) +
                   (-1.14387*vt2_4) + (-0.42251*vt2_5) + (-0.33682*sf2_1) +
                   (-0.94342*sf2_2) + (-0.18043*sf2_3) + (0.11038*sf2_4) +
                   (3.04365*re2_1) + (2.32091*re3_1) + (3.46638*mh3_1) +
                   (2.90426*mh3_2) + (2.37241*mh3_3) + (1.36689*mh3_4) +
                   (0.66514*mh3_5) + (4.61446*mh4_1) + (3.41593*mh4_2) +
                   (2.34247*mh4_3) + (1.28044*mh4_4) + (0.41188*mh4_5))
QOL <- QOL %>% 
  mutate(RAWMCS12 = 
                   (3.93115*pf02_1) + (1.8684*pf02_2) +
                   (2.68282*pf04_1) + (1.43103*pf04_2) + (1.4406*rp2_1) +
                   (1.66968*rp3_1) + (1.48619*bp2_1) + (1.76691*bp2_2) +
                   (1.49384*bp2_3) + (0.90384*bp2_4) + (-1.71175*gh1_1) +
                   (-0.16891*gh1_2) + (0.03482*gh1_3) + (-0.06064*gh1_4) +
                   (-6.02409*vt2_1) + (-4.88962*vt2_2) + (-3.29805*vt2_3) +
                   (-1.65178*vt2_4) + (-0.92057*vt2_5) + (-6.29724*sf2_1) +
                   (-8.26066*sf2_2) + (-5.63286*sf2_3) + (-3.13896*sf2_4) +
                   (-6.82672*re2_1) + (-5.69921*re3_1) + (-10.19085*mh3_1) +
                   (-7.92717*mh3_2) + (-6.31121*mh3_3) + (-4.09842*mh3_4) +
                   (-1.94949*mh3_5) + (-16.15395*mh4_1) + (-10.77911*mh4_2) +
                   (-8.09914*mh4_3) + (-4.59055*mh4_4) + (-1.95934*mh4_5))


  ## *****************************************************************;
  ## *               STEP 5: NORM-BASED STANDARDIZATION OF           *
  ## *                       SCALE SCORES                            *
  ## *****************************************************************;

  ## PCS12 = RAWPCS12 + 56.57706;
  ## MCS12 = RAWMCS12 + 60.75781;
QOL <- QOL %>% 
  mutate(PSC12 = RAWPCS12 + 56.57706)
QOL <- QOL %>% 
  mutate(MCS12 = RAWMCS12 + 60.75781)

missingQOL <- QOL %>% 
  filter(is.na(PSC12))
  
```


## Investigating distribution of scores.

Physical score (PSC12) and mental health scores (MCS12) were not normally distributed therefore differences across groups were tested using Mann-Whitney U test (comparing 2 groups: diagnosis type, sex, flares last year) or Kruksal-Wallis (comparing >2 groups: age groups, faecal calprotectin category).

```{r, investigating distribution of scores}
plot(density(QOL$PSC12))
shapiro.test(QOL$PSC12)
#the above indicate the PSC12 scores are not normally distributed therefore cannot use t-test to compare

ggplot(QOL, aes(x = PSC12, fill = Sex)) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of PSC12 by Sex",
       x = "PSC12",
       y = "Density",
       fill = "Sex") +
  theme_minimal()

plot(density(QOL$MCS12))
shapiro.test(QOL$MCS12)

ggplot(QOL, aes(x = MCS12, fill = Sex)) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of MCS12 by Sex",
       x = "MCS12",
       y = "Density",
       fill = "Sex") +
  theme_minimal()
#the above indicate the MCS12 scores are not normally distributed therefore cannot use t-test to compare
#interesting dip in the centre - could be due to not having option 5 instead of 6 options in the test

```



## Investigating associations with baseline SF12 scores (continuous)

Here we present the summary finings of tests for association. The results can then be seen in the sections and code below.

Summary:

Physical scores (PSC12)

* No statistical significance by diagnosis type
* Statistically significant difference in PSC12 scores by sex (p-value = 3.5e-05)
* There is a statistically significant difference between age groups in PSC12 score, p-value = 4.06e-13
* No statistically significant difference by FC category in PSC12 scores, p-value = 0.1953
* There is a statistically significant difference between flares group (reported in the previous year) in PSC12 score, p-value = 4.6e-08

Mental health scores (MCS12)

* No statistical significance by diagnosis type
* No statistically significant difference in MSC12 scores (p-value = 0.17), could this be due to missing option 4 - these are specific to mental health domains?
* There is a statistially significant difference between age groups in MCS12 score, p-value = 0.0001116
* No statistically significant difference by FC category in PSC12 scores, p-value = 0.5556
* No statistically significant difference between flares group (reported in the previous year) in MCS12 score, p-value = 0.34


Interestingly, there were no associations with sex or flare group for mental health domains, which is out of keeping with other data in PREdiCCt pertaining to mental health.

These tests were re-run using chi-square test and comparing differences between groups using cut-offs of 50 for PSC12 and 42 for MCS12 - associations with key variables remained unchanged. 

### Diagnosis type

Physical scores (PSC12) : No statistical significance by diagnosis type

Mental health scores (MSC12) : No statistical significance by diagnosis type

```{r, create table showing SF12 and MCS12 scores, diagnosis2}
my.render.cont <- function(x) {
  with(
    stats.apply.rounding(stats.default(x),
      digits = 3,
      round.integers = FALSE
    ),
    c("", "Median (IQR)" = sprintf("%s (%s - %s)", MEDIAN, Q1, Q3),
      "Mean" = ifelse(is.numeric(MEAN), sprintf("%.3f", MEAN), MEAN),
      "Standard Deviation" = ifelse(is.numeric(SD), sprintf("%.3f", SD), SD),
      "Range" = sprintf("[%s - %s]", MIN, MAX))
  )
}


table1::table1(~ PSC12 | diagnosis2,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of PSC12 by Diagnosis Type"
)

table1::table1(~ PSC12 | diagnosis2,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of MCS12 by Diagnosis Type"
)

#Mann-Whitney-U PSC12
pairwise_tests <- pairwise.wilcox.test(QOL$PSC12, QOL$diagnosis2, p.adjust.method = "bonferroni")
print(pairwise_tests)
#Mann-Whitney-U MCS12
pairwise_tests <- pairwise.wilcox.test(QOL$MCS12, QOL$diagnosis2, p.adjust.method = "bonferroni")
print(pairwise_tests)

```



### Sex

Statistically significant difference in PSC12 scores by sex (p-value = 3.5e-05)
No statistically significant difference in MSC12 scores (p-value = 0.17), could this be due to missing option 4 - these are specific to mental health domains?

```{r, PSC12 and MCS12 sex}
table1::table1(~ PSC12 | Sex,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of PSC12 by sex"
)


#mental health

table1::table1(~ MCS12 | Sex,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of MCS12 by sex"
)

#Mann-Whitney-U
pairwise_tests <- pairwise.wilcox.test(QOL$PSC12, QOL$Sex, p.adjust.method = "bonferroni")
print(pairwise_tests)

#mental health
#Mann-Whitney-U
pairwise_tests <- pairwise.wilcox.test(QOL$MCS12, QOL$Sex, p.adjust.method = "bonferroni")
print(pairwise_tests)

```



###Age Group

There is a tatistically significant difference between age groups in PSC12 score, p-value = 4.06e-13
There is a statistially significant difference between age groups in MCS12 score, p-value = 0.0001116

```{r, PSC12 and MCS12 AgeGroup}
table1::table1(~ PSC12 | AgeGroup,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of PSC12 by Age Group"
)

#mental health

table1::table1(~ MCS12 | AgeGroup,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of MCS12 by Age Group"
)

#Kruksal Wallis test
kruskal.test(PSC12 ~ AgeGroup, data = QOL)

#mental health
#Kruksal Wallis test
kruskal.test(MCS12 ~ AgeGroup, data = QOL)

```

Flares (in last year)

There is a statistically significant difference between flares group (reported in the previous year) in PSC12 score, p-value = 4.6e-08
There is no statistically significant difference between flares group (reported in the previous year) in MCS12 score, p-value = 0.34
```{r, PSC12 and MCS12 flares}
table1::table1(~ PSC12 | flare_group,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of PSC12 by flares in previous year"
)


table1::table1(~ MCS12 | flare_group,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of MCS12 by flares in previous year"
)

#Mann-Whitney-U
pairwise_tests <- pairwise.wilcox.test(QOL$PSC12, QOL$flare_group, p.adjust.method = "bonferroni")
print(pairwise_tests)

#mental health
#Mann-Whitney-U
pairwise_tests <- pairwise.wilcox.test(QOL$MCS12, QOL$flare_group, p.adjust.method = "bonferroni")
print(pairwise_tests)

```
Faecal Calprotectin

No statistically significant difference by FC category in PSC12 scores, p-value = 0.1953
No statistically significant difference by FC category in PSC12 scores, p-value = 0.5556

```{r, PSC12 and MCS12 FC cat}
table1::table1(~ PSC12 | cat,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of PSC12 by FC category"
)

table1::table1(~ MCS12 | cat,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Summary Statistics of MCS12 by FC category"
)

#Kruksal Wallis test
kruskal.test(PSC12 ~ cat, data = QOL)

#mental health
#Kruksal Wallis test
kruskal.test(MCS12 ~ cat, data = QOL)
```


### Investigating association with grouped SF12 scores

There are limitations in comparing mental health scores given the lack of option "some of the time" in the baseline questionnaire. 
Suggested cut off of 50 for PSC12 to determine a physical condition; while a score of 42 or less on the MCS-12 may be indicative of ‘clinical depression’.

Analyses were re-run using chi-squared to compare grouped SF12 scores - there was no change to associations with key variables.
 

```{r, cut offs an re-analyse for associations}
QOL <- QOL %>% 
  mutate(PSC_grouped = ifelse(PSC12 >= 50, "50+", "<50"))
QOL <- QOL %>% 
  mutate(MCS_grouped = ifelse(MCS12 >= 42, "42+", "<42"))
```

Tests for associations PSC12 with cut off <50 (chi-squared)

* diagnosis type not significantly associated
* sex significant association (p-value = 4.631e-06)
* age group significant (p-value = 9.029e-09)
* flare group significant (p-value = 0.0002242)
* fc category not significantly associated


Test for associations MCS12 with cut off <42 (chi-squared)

* diagnosis type not significantly associated
* sex not significantly associated
* age group significant (p-value = 0.03874)
* flare group not significantly associated
* fc category not significantly associated

```{r, PSC12 and MCS12 grouped tables}
table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat  | PSC_grouped,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Distribution by variable into PSC12 score groupe"
)

table1::table1(~ diagnosis2 + Sex + AgeGroup + flare_group + cat  | MCS_grouped,
  data = QOL,
  render.continuous = my.render.cont,
  caption = "Distribution by variable into MCS12 score groupe"
)

```


```{r, PSC12 and grouped associations}
contingency_table <- table(QOL$diagnosis2, QOL$PSC_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between diagnosis type and PSC12 scores (cut off of 50)")
} else {
  message("There is no significant association between diagnosis type and PSC12 scores (cut off of 50)")
}

contingency_table <- table(QOL$Sex, QOL$PSC_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between sex and PSC12 scores (cut off of 50)")
} else {
  message("There is no significant association between sex and PSC12 scores (cut off of 50)")
}


contingency_table <- table(QOL$AgeGroup, QOL$PSC_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between age group and PSC12 scores (cut off of 50)")
} else {
  message("There is no significant association between age group and PSC12 scores (cut off of 50)")
}

contingency_table <- table(QOL$flare_group, QOL$PSC_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between flare group and PSC12 scores (cut off of 50)")
} else {
  message("There is no significant association between flare group and PSC12 scores (cut off of 50)")
}


contingency_table <- table(QOL$cat, QOL$PSC_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between FC categories and PSC12 scores (cut off of 50)")
} else {
  message("There is no significant association between FC categories and PSC12 scores (cut off of 50)")
}

```

```{r, MCS12 grouped associations}

contingency_table <- table(QOL$diagnosis2, QOL$MCS_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between diagnosis type and MCS12 scores (cut off of 50)")
} else {
  message("There is no significant association between diagnosis type and MCS12 scores (cut off of 50)")
}

contingency_table <- table(QOL$Sex, QOL$MCS_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between sex and MCS12 scores (cut off of 50)")
} else {
  message("There is no significant association between sex and MCS12 scores (cut off of 50)")
}


contingency_table <- table(QOL$AgeGroup, QOL$MCS_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between age group and MCS12 scores (cut off of 50)")
} else {
  message("There is no significant association between age group and MCS12 scores (cut off of 50)")
}

contingency_table <- table(QOL$flare_group, QOL$MCS_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between flare group and MCS12 scores (cut off of 50)")
} else {
  message("There is no significant association between flare group and MCS12 scores (cut off of 50)")
}


contingency_table <- table(QOL$cat, QOL$MCS_grouped)
print(contingency_table)
#chi.sq
chi_squared_result <- chisq.test(contingency_table)
print(chi_squared_result)
# Check if the result is significant at a certain alpha level (e.g., 0.05)
alpha <- 0.05
if (chi_squared_result$p.value < alpha) {
  message("There is a significant association between FC categories and MCS12 scores (cut off of 50)")
} else {
  message("There is no significant association between FC categories and MCS12 scores (cut off of 50)")
}

```